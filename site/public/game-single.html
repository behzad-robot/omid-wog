<html>

<head>
    {{{head}}}
    <style>
        .champ-list-title {
            background-color: #ff8800 !important;
            -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0), inset 0 0 1px 1px #ff8800;
            -moz-box-shadow: 0 1px 2px rgba(0, 0, 0, 0), inset 0 0 1px 1px #ff8800;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0), inset 0 0 1px 1px #ff8800;
            background-image: radial-gradient(ellipse farthest-corner at center 0px, #ffc400 -150%, #ffc400 45%, #ff8800 85%);
            display: inline-block;
            width: auto;
            padding: 5px 10px;
            /* border-top-left-radius: 5px;
            border-bottom-left-radius: 5px; */
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .champ-list-title h2 {
            font-size: 28px;
            margin: 0;

        }

        .champ-box {
            color: white !important;
            border: 1px solid #000;
            background: #1a1b1f;
            position: relative;
            display: inline-block;
            width: 10%;
            margin: 2px 2px;
            float: right;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none !important;
            height: 170px;
        }

        .champ-box:hover {
            box-shadow: 0 0 15px rgba(255, 136, 0, 0.8);
            background: #2a2b2f;
        }

        .dota2 .champ-box {
            width: 15%;
            /* margin: 2px 2px; */
        }

        .champ-box::before {
            box-shadow: 0 1px 3px rgba(0, 0, 0, .4), inset 0 1px 1px rgba(255, 255, 255, .2);
            content: "";
            display: block;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 0;
            border-radius: 5px;
        }

        .champ-box .icon {
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        .champ-box .zoom {
            transition: transform 0.2s;
            transform: scale(0);
            position: absolute;
            top: 0;
            left: 0;
        }

        .champ-box:hover {
            z-index: 1000;
        }

        .champ-box:hover .zoom {
            transform: scale(2);
            z-index: 9999;
            border-radius: 5px;
            border: 1px solid #000;
            box-shadow: 1px 2px 10px #000;
        }

        .champ-box .content {
            position: relative;
            width: 100%;
            z-index: 1;
        }

        .champ-box .content h4 {
            font-size: 14px;
            margin: 5px 0;
            height: 30px;
            text-overflow: clip;
        }

        @media (max-width: 576px) {
            .dota2 .champ-box {
                width: 23%;
                margin: 2px;
                float: right;
                height: 160px;
                margin-bottom: 5px;
                overflow: hidden;

            }

            .dota2 .champ-box .zoom {
                display: none;
            }
        }

        .champ-box.item-box {
            width: 8%;
            height: 96px;
        }

        .champ-box.item-box .content h4 {
            font-size: 10px;
            display: block;
            height: 30px;
            text-overflow: clip;
        }

        .dota2 .champ-box.item-box {
            width: 10%;
            overflow: hidden;

        }

        .dota2 .champ-box.item-box .content h4 {
            font: 8px;
            text-overflow: clip;
        }

        @media (max-width: 576px) {
            .dota2 .champ-box.item-box {
                width: 18%;
                margin: 2px;
                float: right;
                height: 85px;
                margin-bottom: 5px;
                overflow: hidden;

            }
        }

        .build-box {
            display: block;
            border: 1px solid #111;
            border-bottom: 1px solid #2e2e2e;
            background: #0f0f0f;
            padding: 0px;
            overflow: hidden;

        }

        .build-box .icon-wrapper {
            width: 20%;
            display: inline-block;
            float: right;
            padding: 5px;
        }

        .build-box .icon-wrapper img {
            border-radius: 2px;
        }

        .build-box .content-wrapper {
            width: 80%;
            display: inline-block;
            float: right;
            padding: 5px;
        }

        .build-box .content-wrapper h4 {
            font-size: 18px;
            margin-bottom: 2px;
        }

        .build-box .content-wrapper .username {
            font-size: 12px;
            color: #ff8800;
        }

        .build-box .content-wrapper .item-wrapper {
            margin-top: 5px;
        }

        .build-box .content-wrapper .item-wrapper .item {
            width: 26px;
            /* border:1px solid #eee; */
            margin: 0 2px;
        }

        .build-box .vote-wrapper {
            position: absolute;
            top: 3px;
            left: 3px;
        }

        .build-box .vote-wrapper span {
            display: block;
            font-size: 10px;
            margin: 2px 0;
        }

        .stream-box {
            display: block;
            width: 100%;
            border: 1px solid #111;
            border-bottom: 1px solid #2e2e2e;
            background: #1e1e1e;
            padding: 0px;
            overflow: hidden;
            font-size: 12px;
            margin-bottom: 5px;
            text-decoration: none !important;
        }

        .stream-box:hover {
            background: #2e2e2e;
            border: 1px solid #ffc400;
        }

        .stream-box span {
            display: block;
            padding: 5px 10px;
        }
    </style>
</head>

<body>
    {{{navbar}}}
    <section class="parralax-fixed-height" style="background-image:url('{{game.cover}}');height:250px;position: relative">
        <div class="wog-overlay"></div>
        <div class="container text-center" style="z-index:1;position: relative;padding-top:35px">
            <h1 class="shadow-text" style="color:white;font-size:54px;">{{game.name}}</h1>
        </div>
    </section>
    <section class="bg-section" style="padding-top:20px;">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <div class="champ-list-title">
                        <h2>قهرمان ها</h2>
                    </div>
                    <div id="champs-row" class="{{game.token}}" style="overflow:hidden;padding-bottom:10px;">
                        <!-- <div class="champ-box text-center"><div class="content"><img class="icon" src="/assets/axe.jpg" width="100%" /><img src="/assets/axe-gif.gif" class="zoom" width="100%" /><h4>Kaisa</h4></div></div> -->
                        <div name="loading" class="text-center" style="margin:10px 0;">
                            <img src="/images/loading.gif" width="72px" />
                        </div>
                        <!-- {{#champions}}
                        <div class="champ-box text-center">
                            <div class="content"><img class="icon" src="{{icon}}" width="100%" /><img src="{{icon_gif}}"
                                    class="zoom" width="100%" />
                                <a href="/champions/{{slug}}">
                                    <h4 class="text-white text-english">{{name}}</h4>
                                </a>
                            </div>
                        </div>
                        {{/champions}} -->
                    </div>
                    <div class="btn btn-md btn-black" id="champions-load-more-btn" onclick="champions_show_all()"><span>مشاهده
                            همه</span></div>
                    <hr />
                    <div class="champ-list-title">
                        <h2>آیتم ها</h2>
                    </div>
                    <div id="items-row" class="{{game.token}}" style="overflow:hidden;margin-bottom:10px;">
                        <div name="loading" class="text-center" style="margin:10px 0;">
                            <img src="/images/loading.gif" width="72px" />
                        </div>
                        <!--<div class="champ-box item-box text-center"><div class="content"><img class="icon" src="/images/s4.png" width="100%" /><h4>{{name}}</h4></div></div> -->
                        <!-- {{#game.items}}
                        <div class="champ-box item-box text-english text-center" itemId="{{_id}}">
                            <div class="content"><img class="icon" src="{{icon}}" width="100%" />
                                <h4 class="text-english">{{name}}</h4>
                            </div>
                        </div>
                        {{/game.items}} -->
                    </div>
                    <div class="btn btn-md btn-black" id="items-load-more-btn" onclick="items_show_all()"><span>مشاهده
                            همه</span></div>
                    <script>
                        let champions = [];
                        let builds = [];
                        let game = undefined;
                        let streamers = [];
                        $(document).ready(() => {
                            getGame('{{game._id}}', (g) => {
                                game = g;
                                items_create();
                                getChampions('?gameId=' + `{{game._id}}`, (cs) => {
                                    champions = cs;
                                    //draw champions:
                                    champions_create();
                                    //load builds:
                                    getBuilds('?gameId=' + `{{game._id}}`, game, champions, (bs) => {
                                        builds = bs;
                                        builds_create();
                                    });
                                    //twitch streamers:
                                    getTwitchStreamersFor(33214, (ss) => {
                                        streamers = ss;
                                        streamers_create();
                                    });
                                    console.log("plz load media!");
                                    //media:
                                    getMedia('?gameId=' + game._id, (media) => {
                                        var container = $("#game-gallery-box");
                                        console.log(media);
                                        for (var i = 0; i < media.length; i++) {
                                            var m = media[i];
                                            $(container).append(`<a class="img-col" href="${m.siteUrl}"><img src="${m.thumbnail}" width="100%"></a>`);
                                        }
                                        $("#game-gallery-box [name=loading]").hide();
                                    });
                                });
                            });
                            // var champBox = $("#champs-row").html();
                            // for (var i = 0; i < 27; i++) {
                            //     // $("#champs-row").append(champBox);
                            //     $("#champs-row").append(`<div class="champ-box text-center"><div class="content"><img class="icon" src="/assets/axe.jpg" width="100%" /><img src="/assets/axe-gif.gif" class="zoom" width="100%" /><h4>Kaisa</h4></div></div>`);
                            // }
                            // for (var i = 0; i < 27; i++) {
                            //     // $("#champs-row").append(champBox);
                            //     $("#items-row").append(`<div class="champ-box item-box text-center"><div class="content"><img class="icon" src="/images/s4.png" width="100%" /><h4>Item</h4></div></div>`);
                            // }
                        });
                        function champions_create() {
                            for (var i = 0; i < champions.length; i++) {
                                var c = champions[i];
                                $("#champs-row").append(
                                    `<a href="/champions/${c.slug}" class="champ-box champ text-center" index="${i}">`
                                    + `<div class="content"><img class="icon" src="${c.icon_tall}" width="100%" /><img src="${c.icon_gif}" class="zoom" width="100%" />`
                                    + `<h4 class="text-white text-english">${c.name}</h4>`
                                    + `</div>`
                                    + `</a>`
                                );
                                if (i >= 28)
                                    $(`.champ-box[index=${i}]`).hide();
                            }
                            $("#champs-row [name=loading]").hide();
                        }
                        function champions_show_all() {
                            $(`.champ-box.champ`).show();
                            $("#champions-load-more-btn").hide();
                        }
                        function items_create() {
                            for (var i = 0; i < game.items.length; i++) {
                                const item = game.items[i];
                                $("#items-row").append(
                                    `<div class="champ-box item-box  text-english text-center" itemId="${item._id}">`
                                    + `<div class="content"><img class="icon" src="${item.icon}" width="100%" />`
                                    + `<h4 class="text-english">${item.name}</h4>`
                                    + `</div>`
                                    + `</div>`
                                );
                                if (i >= 28)
                                    $(`.item-box[itemId=${item._id}]`).hide();
                            }
                            $("#items-row [name=loading]").hide();
                        }
                        function items_show_all() {
                            $(`.item-box`).show();
                            $("#items-load-more-btn").hide();
                        }
                        function builds_create() {
                            for (var i = 0; i < builds.length; i++) {
                                if (builds[i].itemRows.length == 0)
                                    continue;
                                var b = builds[i];
                                var items_str = ``;
                                var row = b.itemRows[b.itemRows.length >= 2 ? 1 : 0];
                                console.log(row);
                                for (var j = 0; j < row.items.length; j++) {
                                    var it = row._items[j];
                                    items_str += `<img src="${it.icon}" class="item" />`;
                                }
                                $("#builds-row").append(
                                    `<div class="card build-box">`
                                    + `<div class="icon-wrapper"><img src="${b._champ.icon_tall}" width="100%" /></div>`
                                    + `<div class="content-wrapper">`
                                    + `<h4>${b.title}</h4><b class="username">توسط <span userId="${b.userId}" label="username">??</span></b><div class="item-wrapper">${items_str}</div>`
                                    + `</div>`
                                    + `<div class="vote-wrapper"><span><i class="fas fa-thumbs-up"></i>&nbsp;&nbsp;0 رای</span><span><i class="fas fa-eye"></i>&nbsp;&nbsp;0 بازدید</span><span><i class="fas fa-comment"></i>&nbsp;&nbsp;0 نظر</span></div>`
                                    + `</div>`
                                );
                                const userId = b.userId;
                                getUser(userId, (user) => {
                                    var thing = $(`[userId=${userId}]`);
                                    var label = $(thing).attr('label');
                                    $(thing).html(user[label]);
                                });
                            }
                            $("#builds-row [name=loading]").hide();
                        }
                        function streamers_create() {
                            console.log("streamers loaded " + streamers.length);
                            for (var i = 0; i < streamers.length && i < 3; i++) {
                                var s = streamers[i];
                                console.log(s);
                                $("#streamers-row").append(`<a class="stream-box text-white" href="${s.url}"><img src="${s.thumbnail}" width="100%" /><span>${s.title}</span></a>`);
                            }
                            $("#streamers-row [name=loading]").hide();
                        }

                    </script>
                </div>
                <div class="col-md-4">
                    <h3>تازه های آموزش ها:<div class="btn btn-xs btn-green float-left" style="margin-top:5px;"><span>مشاهده
                                همه</span></div>
                    </h3>
                    <div id="builds-row">
                        <div name="loading" class="text-center" style="margin:10px 0;width:100%;">
                            <img src="/images/loading.gif" width="72px" />
                        </div>
                    </div>
                    <!-- <div class="card build-box">
                        <div class="icon-wrapper">
                            <img src="/images/s4.png" width="100%" />
                        </div>
                        <div class="content-wrapper">
                            
                            <h4>عنوان آموزش</h4>
                            <b class="username">laku22</b>
                            <div class="item-wrapper">
                                <img src="/images/s5.jpg" class="item" />
                                <img src="/images/s5.jpg" class="item" />
                                <img src="/images/s5.jpg" class="item" />
                                <img src="/images/s5.jpg" class="item" />
                                <img src="/images/s5.jpg" class="item" />
                                <img src="/images/s5.jpg" class="item" />
                                <img src="/images/s5.jpg" class="item" />
                            </div>
                        </div>
                    </div> -->
                    <h3 style="margin-top:10px;font-size:22px;">استریم جماعت:</h3>
                    <div id="streamers-row" class="row">
                        <div name="loading" class="text-center" style="margin:10px 0;width:100%;">
                            <img src="/images/loading.gif" width="72px" />
                        </div>
                        <!-- <div class="col-md-12">
                            <div class="stream-box">
                                <img src="/images/sample-stream.jpg" width="100%" />
                                <span>عنوان کذایی</span>
                            </div>
                        </div>
                        -->
                    </div>
                    <!-- <div class="btn btn-sm btn-secondary">مشاهده همه</div> -->
                    <!-- Game Gallery -->
                    <div class="widget-box" style="margin-top:10px;">
                        <div class="title-wrapper">
                            <h3>گالری</h3>
                        </div>
                        <div class="content-wrapper" id="game-gallery-box">
                            <!-- <a class="img-col" href="#">
                                <img src="/images/s1.jpg" width="100%">
                            </a> -->
                            <div name="loading" class="text-center" style="margin:10px 0;width:100%;">
                                <img src="/images/loading.gif" width="72px" />
                            </div>
                        </div>
                    </div>
                    <!-- END Game Gallery -->
                </div>
            </div>
        </div>
    </section>
    {{{footer}}}
</body>

</html>