<html>

<head>
    {{{head}}}
    <title>بازی های گروهی ESL One Birmingham 2019</title>
    <meta name="description" content="{{_wogSEO.description}}">
    <meta name="keywords" itemprop="keywords" content="{{_wogSEO.keywords}}">
    <link rel="canonical" href="http://worldofgamers.ir/">

    <meta property="og:locale" content="fa_IR">
    <meta property="og:type" content="article">
    <meta property="og:title" content="بازی های گروهی ESL One Birmingham 2019">
    <meta property="og:description" content="{{_wogSEO.description}}">
    <meta property="og:url" content="{{_wogSEO.fullUrl}}">
    <meta property="og:image" content="http://worldofgamers.ir/wog-logo.png">
    <meta property="og:site_name" content="واج">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@wogcompany">
    <meta name="twitter:description" content="{{_wogSEO.description}}">
    <meta name="twitter:title" content="بازی های گروهی ESL One Birmingham 2019">
    <meta name="twitter:image" content="http://worldofgamers.ir/images/wog-logo.png">
    <style>
        footer {
            margin: 0;
        }

        .section-main {
            background-image: url('/dota2book/images/immortals_bg.jpg');
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            padding-top: 20px;
            padding-bottom: 20px;
        }

        .player-details {
            background-color: #242029;
            margin-top: 10px;
            margin-bottom: 10px;
            padding: 10px 20px;
            border-radius: 10px
        }

        .see-rankings {
            display: block;
            background-image: url('/dota2book/images/green-book-logo.png');
            height: 130px;
            margin-top: 10px;
            margin-bottom: 10px;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            padding-top: 45px;
            border-radius: 20px
        }

        .see-rankings-text {
            color: white;
            text-decoration: none;
        }

        .see-rankings-text:hover {
            text-decoration: none;
            color: lightgray;
        }

        .bet-box {
            display: block;
            width: 100%;
            position: relative;
            min-height: 200px;
            border: 2px solid #d8064f;
            border-radius: 5px;
            margin-bottom: 10px;
            background: linear-gradient(160deg, #0d2740 0%, #1d203d 100%);
        }

        .bet-box.disabled {
            position: relative;
        }

        .bet-box.disabled .overlay {
            width: 100%;
            height: 100%;
            background-color: rgba(20, 20, 20, 0.7);
            z-index: 2;
            position: absolute;
            color: white;
            text-align: center;
            padding-top: 10px;
            font-size: 20px;
        }

        .bet-box .content {
            position: relative;
            z-index: 1;
        }

        .bet-box .team-row {
            display: block;
            width: 100%;
            height: 140px;
            position: relative;
            background-size: cover;
            background-position: center;
            cursor: pointer;
        }

        .bet-box .team-row:nth-of-type(1) {
            border-top-right-radius: 5px;
            border-top-left-radius: 5px;
            border-bottom: 1px solid #d8064f;
        }

        .bet-box .team-row .team-overlay {
            position: absolute;
            color: white;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            text-align: center;
            opacity: 0;
            transition: all 300ms;
            padding-top: 50px;
            font-weight: bold;
            text-shadow: 2px 3px 3px rgba(0, 0, 0, 0.6);
            font-size: 18px;
        }

        .bet-box .team-row:hover .team-overlay {
            opacity: 1;
        }

        .bet-box .team-row:hover .team-overlay span {
            display: inline;
        }

        .bet-box .team-row .team-selected-mark {
            display: none;
            position: absolute;
            top: 2px;
            left: 2px;
            color: white;
            text-align: center;
        }

        .bet-box .coins-row {
            display: block;
            width: 100%;
            overflow: hidden;
        }

        .bet-box .coins-row .coins-input-wrapper {
            position: relative;
            display: block;
            padding: 5px 10px;
        }

        .bet-box .coins-row .coins-input-wrapper .coins-icon {
            width: 32px;
            height: 32px;
            top: 10px;
            right: 15px;
            position: absolute;
        }

        .bet-box .coins-row .coins-input-wrapper .coins-input {
            padding-right: 40px;
            display: inline-block;
            width: 120px;
        }

        .bet-box .coins-row .coins-input-wrapper .warning-icon {
            display: inline-block;
            vertical-align: top;
            width: 32px;
            float: left;
        }

        .bet-box .coins-row .coins-input-wrapper .warning-text {
            display: inline;
            color: white;
            font-size: 14px;
            float: left;
            padding-top: 8px;
            padding-right: 5px;
        }

        .bet-box .form-control[readonly] {
            background-color: #ccc;
            border: 3px solid #aaa;
        }

        .bet-box .message-row {
            color: #a00;
            padding: 10px 20px;
        }

        /* selected behaviour */
        .bet-box .team-row.selected {
            border: 1px solid greenyellow;
        }

        .bet-box .team-row.selected .team-overlay {
            display: none !important;
            opacity: 0 !important;
        }

        .bet-box .team-row.selected .team-selected-mark {
            display: block;
        }

        /* not-selected behaviour */
        .bet-box .team-row.not-selected .team-overlay {
            display: block !important;
            opacity: 1 !important;
        }

        .bet-box .team-row.not-selected .team-overlay span {
            display: none !important;
        }

        .bet-box .team-row.not-selected .team-selected-mark {
            display: none !important;
        }

        /* picked behaviour */
        .bet-box .team-row.picked {
            border: 1px solid greenyellow;
        }

        .bet-box .team-row.picked .team-selected-mark {
            display: block;
        }

        /* not-picked behaviour */
        .bet-box .team-row.not-picked .team-overlay {
            opacity: 1;
        }

        .bet-box .team-row.not-picked .team-overlay span {
            display: none;
        }

        .bet-box .team-row.not-picked:hover .team-overlay span {
            display: inline;
        }

        .social-box {
            background-color: #202d4f;
            border: 2px solid #38486d;
            border-radius: 10px;
            padding-bottom: 10px;
            width: 30%;
            height: 310px;
            display: inline-block;
        }

        .profile-link {
            color: orange;
            font-size: 12px
        }

        .profile-link:hover {
            color: rgb(201, 147, 47);
            text-decoration: none
        }

        .check-and-coins-row {
            border-top: 2px solid #38486d;
            padding: 10px 10px;
        }

        @media (max-width: 576px) {
            .social-box {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    {{{navbar}}}
    <navfiller></navfiller>
    <section class="section-main">
        <div class="container">
            <div class="row">
                <div class="col-md-4 col-12">
                    <div class="player-details">
                        <div class="row">
                            <div class="col-md-4 col-4">
                                <img src="/dota2book/images/Ti9_battle_pass.png" style="width:100%" alt="">
                            </div>
                            <div class="col-md-8 col-8">
                                <h2 style="color:white;font-weight: bold">{{currentUser.username}}</h2>
                                <h6 style="color: white">رتبه:{{rank}}</h6>
                                <h6 style="color:orange">سکه:&nbsp;<span>{{currentUser.dota2Book2019.coins}}</span></h6>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4"></div>
                <div class="col-md-4 col-12">
                    <a class="see-rankings text-center" href="{{#SITE_URL}}/dota2-book/leaderboard{{/SITE_URL}}">
                        <span class="see-rankings-text" href="#">مشاهده رتبه بندی‌ها</span>
                    </a>
                </div>
            </div><!-- end of row-->
            <h2 style="color:white;margin-bottom: 10px">بازی های گروهی&nbsp;<span class="text-english">ESL One
                    Birmingham 2019</span></h2>
            <p style="color:white">به مرحله بازی های گروهی خوش آمدید برای هر مسابقه نتیجه را پیش بینی کنید در صورتی که
                پیش بینی شما درست
                باشد همان تعداد سکه برنده می شوید در صورتی که اشتباه باشد سکه ای از دست نمی دهید دقت داشته باشید که پس
                از ثبت امکان تغییر انتخاب ها وجود ندارد.</p>
            <!-- warning sign -->
            <div class="alert alert-warning" id="warning-alert" style="display:none">^_^</div>
            <!-- start form -->
            <form id="bets-form" action="/dota2-book/submit-bets" method="POST">
                <h3 style="color:white">گروه A:</h3>
                <div class="row" id="group-a"></div>
                <h3 style="color:white">گروه B:</h3>
                <div class="row" id="group-b"></div>
                <div name="submit-wrapper" style="color:white;">
                    <input type="submit" class="btn btn-md btn-warning" value="ثبت پیش بینی ها" />
                </div>
            </form>
            <script>
                //create data , functions:
                let coinsShowVal = 0;
                const ESL_TEAMS = JSON.parse(`{{{ESL_TEAMS}}}`);
                const GROUP_A_TOKENS = JSON.parse(`{{{GROUP_A}}}`);
                const GROUP_B_TOKENS = JSON.parse(`{{{GROUP_B}}}`);
                const GROUP_A = [], GROUP_B = [];
                for (var i = 0; i < GROUP_A_TOKENS.length; i++)
                    GROUP_A.push(getTeam(GROUP_A_TOKENS[i]));
                for (var i = 0; i < GROUP_B_TOKENS.length; i++)
                    GROUP_B.push(getTeam(GROUP_B_TOKENS[i]));
                console.log(ESL_TEAMS);
                const ALL_BETS = JSON.parse(`{{{ALL_BETS}}}`);
                const currentUser = {
                    _id: `{{currentUser._id}}`,
                    username: `{{currentUser.username}}`,
                    token: `{{{currentUser.token}}}`,
                    dota2Book2019: JSON.parse(`{{{DOTA2_BOOK_2019}}}`),
                };
                console.log(currentUser);
                $(() =>
                {
                    //check if all bets are already done:
                    // let allBetsDone = true;
                    // for (var i = 0; i < ALL_BETS.length; i++)
                    // {
                    //     let bet = ALL_BETS[i];
                    //     let userBet = getBet(bet.token);
                    //     if (bet.active && userBet == undefined)
                    //     {
                    //         allBetsDone = false;
                    //         break;
                    //     }
                    // }
                    // if (allBetsDone)
                    //     $("#bets-form [name=submit-wrapper]").html('با تشکر از مشارکت شما به زودی پیش بینی های بیشتری اضافه می شود.');
                    //render all group stage bets:
                    for (var i = 0; i < GROUP_A.length; i++)
                    {
                        for (var j = i + 1; j < GROUP_A.length; j++)
                        {
                            render_bet('#group-a', GROUP_A[i], GROUP_A[j]);
                        }
                    }
                    for (var i = 0; i < GROUP_B.length; i++)
                    {
                        for (var j = i + 1; j < GROUP_B.length; j++)
                        {
                            render_bet('#group-b', GROUP_B[i], GROUP_B[j]);
                        }
                    }
                    let allInActive = true;
                    for (var i = 0; i < ALL_BETS.length; i++)
                    {
                        if (ALL_BETS[i].active)
                        {
                            allInActive = false;
                            break;
                        }
                    }
                    if (allInActive)
                    {
                        $("#group-a").html('<div class="col-12 text-center" style="padding:20px 0;color:white;">به زودی مسابقات اعلام می شود دوباره به ما سر بزنید.</div>')
                        $("#group-b").html('<div class="col-12 text-center" style="padding:20px 0;color:white;">به زودی مسابقات اعلام می شود دوباره به ما سر بزنید.</div>')
                        $("#bets-form input[type=submit]").hide();
                    }
                    $(".bet-box .team-row").click(function ()
                    {
                        let betBox = $(this).closest('.bet-box');
                        let betToken = $(betBox).attr('betToken');
                        let bet = getBet(betToken);
                        let team = getTeam($(this).attr('team'));
                        let userBet = getUserBet(betToken);
                        if (userBet != undefined)
                        {
                            console.log('have userBet for this bet!');
                            return;
                        }
                        //update views:
                        let hiddenInput = $(betBox).find('input[type=hidden]');
                        $(hiddenInput).val(team.token);
                        let teamRows = $(betBox).find('.team-row');
                        $(teamRows).removeClass('picked');
                        $(teamRows).removeClass('not-picked');
                        for (var i = 0; i < teamRows.length; i++)
                        {
                            let t = $(teamRows[i]).attr('team');
                            if (t == team.token)
                                $(teamRows[i]).addClass('picked');
                            else
                                $(teamRows[i]).addClass('not-picked');
                        }
                        //check coins input:
                        let messageRow = $(betBox).find('.message-row');
                        let coinsVal = parseInt($(betBox).find('input[type=number]').val());
                        if (isNaN(coinsVal))
                        {
                            $(messageRow).html('مقدار سکه ها را نیز وارد کنید.');
                        }
                        else if (coinsVal <= 0)
                        {
                            $(messageRow).html('مقدار سکه ها صحیح نیست.');
                        }
                        else if (coinsVal > bet.maxCoins)
                        {
                            $(messageRow).html('مقدار سکه ها بیشتر از حداکثر مجاز است.');
                        }
                        else
                            $(messageRow).html('');
                    });
                    $(".bet-box input[type=number]").change(function ()
                    {
                        let betBox = $(this).closest('.bet-box');
                        let betToken = $(betBox).attr('betToken');
                        let bet = getBet(betToken);
                        let team = getTeam($(this).attr('team'));
                        let userBet = getUserBet(betToken);
                        let coinsVal = $(this).val();
                        let hiddenInputVal = $(betBox).find('input[type=hidden]').val();
                        let messageRow = $(betBox).find('.message-row');
                        if (isEmptyString(hiddenInputVal))
                        {
                            $(messageRow).html('تیم برنده را نیز مشحخص کنید.');
                        }
                        else if (isNaN(coinsVal))
                        {
                            $(messageRow).html('مقدار سکه ها را نیز وارد کنید.');
                        }
                        else if (coinsVal <= 0)
                        {
                            $(messageRow).html('مقدار سکه ها صحیح نیست.');
                        }
                        else if (coinsVal > bet.maxCoins)
                        {
                            $(messageRow).html('مقدار سکه ها بیشتر از حداکثر مجاز است.');
                        }
                        else
                            $(messageRow).html('');
                    });
                    $("#bets-form").submit(() =>
                    {
                        let betBoxes = $(".bet-box");
                        let coinsSum = 0;
                        for (var i = 0; i < betBoxes.length; i++)
                        {
                            let box = $(betBoxes[i]);
                            let betToken = $(betBoxes[i]).attr('betToken');
                            let bet = getBet(betToken);
                            let userBet = getUserBet(betToken);
                            if (!bet.active)
                                continue;
                            if (userBet != undefined)
                                continue;
                            let betPick = $(box).find('input[type=hidden]').val();
                            let betCoins = parseInt($(box).find('input[type=number]').val());
                            let teamA = getTeam($(box).attr('teamA'));
                            let teamB = getTeam($(box).attr('teamB'));
                            if (isEmptyString(betPick))
                            {
                                if (!isNaN(betCoins))
                                {
                                    alert('برنده مسابقه ' + teamA.name + ' در برابر ' + teamB.name + ' را مشخص کنید.');
                                    return false;
                                }
                            }
                            else
                            {
                                if (isNaN(betCoins) || betCoins <= 0)
                                {
                                    alert('سکه ها را برای مسابقه ' + teamA.name + ' در برابر ' + teamB.name + ' وارد کنید.');
                                    return false;
                                }
                                else if (betCoins > bet.maxCoins)
                                {
                                    alert('سکه ها برای مسابقه ' + teamA.name + ' در برابر ' + teamB.name + ' بیش از حد مجاز می باشد.');
                                    return false;
                                }
                                else
                                    coinsSum += betCoins;
                            }
                        }
                        if (coinsSum > currentUser.dota2Book2019.coins)
                        {
                            alert('بیش از موجودی خود سکه وارد کرده اید.');
                            return false;
                        }
                        return true;
                    });
                });
                //data functions:
                function getTeam(token)
                {
                    for (var i = 0; i < ESL_TEAMS.length; i++)
                        if (ESL_TEAMS[i].token == token)
                            return ESL_TEAMS[i];
                    return undefined;
                }
                function getBet(token)
                {
                    for (var i = 0; i < ALL_BETS.length; i++)
                        if (ALL_BETS[i].token == token)
                            return ALL_BETS[i];
                    return undefined;
                }
                function getUserBet(token)
                {
                    for (var i = 0; i < currentUser.dota2Book2019.bets.length; i++)
                    {
                        if (currentUser.dota2Book2019.bets[i].token == token)
                            return currentUser.dota2Book2019.bets[i];
                    }
                    return undefined;
                }
                //render functions:
                function render_bet(parent, teamA, teamB)
                {
                    let betToken = 'matchup_' + teamA.token + '_vs_' + teamB.token;
                    let bet = getBet(betToken);
                    if (bet == undefined)
                        return;
                    let userBet = getUserBet(betToken);
                    let disabledOverlay = '', hiddenInput = '', aRowSelected = '', bRowSelected = '';
                    if (!bet.active)
                    {
                        disabledOverlay = `<div class="overlay">مهلت پیش بینی این مورد گذشته است.</div>`;
                    }
                    else
                    {
                        if (userBet == undefined)
                        {
                            hiddenInput = `<input type="hidden" name="${bet.token}" value=""/>`;
                            aRowSelected = '';
                            bRowSelected = '';
                        }
                        else
                        {
                            hiddenInput = '';
                            aRowSelected = userBet.value == teamA.token ? 'selected' : 'not-selected';
                            bRowSelected = userBet.value == teamB.token ? 'selected' : 'not-selected';
                        }
                    }
                    console.log(bet);
                    $(parent).append(`
                        <div class="col-md-4 col-12">
                            <div class="bet-box ${bet.active ? '' : 'disabled'}" betToken="${bet.token}" teamA="${teamA.token}" teamB="${teamB.token}">
                                ${disabledOverlay}
                                ${hiddenInput}
                                <div class="content">
                                    <div class="team-row ${aRowSelected}" style="background-image:url('${teamA.logo}')" team="${teamA.token}">
                                        <div class="team-overlay"><span>${(aRowSelected != 'selected') ? ('انتخاب ' + teamA.name) : (teamA.name + ' انتخاب شده است.')}</span></div>
                                        <div class="team-selected-mark">
                                            <span class="badge badge-warning">
                                                <span class="fas fa-${aRowSelected != 'selected' ? 'check' : 'lock'}"></span>&nbsp;انتخاب شما
                                            </span>
                                        </div>
                                    </div>
                                    <div class="team-row ${bRowSelected}" style="background-image:url('${teamB.logo}')" team="${teamB.token}">
                                        <div class="team-overlay"><span>${(bRowSelected != 'selected') ? ('انتخاب ' + teamB.name) : (teamB.name + ' انتخاب شده است.')}</span></div>
                                        <div class="team-selected-mark">
                                            <span class="badge badge-warning">
                                                <span class="fas fa-${bRowSelected != 'selected' ? 'check' : 'lock'}"></span>&nbsp;انتخاب شما
                                            </span>
                                        </div>
                                    </div>
                                    <div class="coins-row">
                                        <div class="coins-input-wrapper">
                                            <img class="coins-icon" src="/dota2book/images/coins.png"/>
                                            <input type="number" name="${bet.token}-betCoins" value="${userBet != undefined ? userBet.coins : ''}" ${userBet != undefined ? 'readonly' : ''} placeholder="سکه ها" class="form-control coins-input "/> 
                                            <span class="warning-text">حداکثر ${bet.maxCoins} سکه</span>
                                            <img class="warning-icon" src="/dota2book/images/error.png"/>
                                        </div>
                                    </div>
                                    <div class="message-row">

                                    </div>
                                </div>
                            </div>
                        </div>
                    `);
                }
            </script>
            <!-- end form logic -->
            <!-- other ways of earning money -->
            <h1 style="color:white">سکه میخوای؟</h1>
            <div class="social-box" style="margin-top: 10px">
                <div class="text-center">
                    <img src="/dota2book/images/twitch-logo.png" style="width:40%;padding-top: 10px" alt="">
                    <h6 style="color:white;margin-top: 10px">صفحه تویتچ واج را دنبال کنید</h6>
                </div>
                <p style="color:lightgrey;font-size: 12px;padding-right: 10px">به بخش <span><a
                            href="/users/{{currentUser.username}}/edit" class="profile-link"> ویرایش مشخصات
                            کاربری </a></span>رفته و آیدی تویتچ
                    خود را وارد کنید و صفحه تویتچ <a href="https://twitch.tv/Gosu" class="text-english orange-link"
                        target="_blank">Gosu</a> را دنبال کنید،سپس دکمه بررسی را فشار دهید.</p>
                <div class="check-and-coins-row">
                    <div style="position: relative;display:inline-block;width: 40%">
                        <img style="position: absolute;width: 25%;padding-top: 4px" src="/dota2book/images/coins.png" />
                        <button type="button" class="btn btn-success"
                            style="padding-right: 30px;width: 100%;font-size: 14px">جایزه 100 سکه</button>
                    </div>
                    <div style="position: relative;display:inline-block;width: 40%">
                        <div onclick="checkTwitchFollower('Gosu',this)" id="btn_follow_twitch" type="button"
                            class="btn btn-warning" style="width: 100%;font-size: 14px;margin-right: 50px">بررسی</div>
                        <div id="label_follow_twitch" type="button" class="btn btn-success"
                            style="width: 100%;font-size: 14px;margin-right: 50px;display:none;">انجام شده
                        </div>
                    </div>
                </div>
            </div>
            <script>
                let twitchLoading = false;
                $(() =>
                {
                    let hasFollowedTwitch = false;
                    for (var i = 0; i < currentUser.dota2Book2019.actions.length; i++)
                    {
                        let a = currentUser.dota2Book2019.actions[i];
                        if (a.token == 'follow_twitch')
                        {
                            $("#btn_follow_twitch").hide();
                            $("#label_follow_twitch").show();
                            hasFollowedTwitch = true;
                            break;
                        }
                    }
                    if (!hasFollowedTwitch)
                    {
                        $("#warning-alert").html('شما می توانید با دنبال کردن تویتچ سکه بیشتری کسب کنید برای پیش بینی ها.');
                        $("#warning-alert").show();
                    }
                });
                function checkTwitchFollower(channelName, btn)
                {
                    if (twitchLoading)
                        return;
                    $(btn).html('در حال بارگذاری...');
                    twitchLoading = true;
                    fetch('/dota2-book/check-twitch/?channelName=' + channelName, {
                        method: 'GET',
                    }).then((response) => response.json()).then((result) =>
                    {
                        if (result.code == 400)
                        {
                            twitchLoading = false;
                            $(btn).html('بررسی مجدد');
                            alert('به بخش ویرایش اطلاعات کاربری رفته و آیدی تویتچ خود را وارد کنید.');
                            return;
                        }
                        if (result.code == 500)
                        {
                            twitchLoading = false;
                            $(btn).html('بررسی مجدد');
                            alert('خطای سرور:' + result.error.toString());
                            return;
                        }
                        alert('با موفقیت انجام شد.');
                        $(btn).html('انجام شده');
                        location.reload();
                    }).catch((err) =>
                    {
                        twitchLoading = false;
                        $(btn).html('بررسی مجدد');
                        alert('خطای سرور:' + err.toString());
                    });
                }
            </script>
            <!-- end of other ways of earning money-->
        </div> <!-- end of container -->
    </section>
    {{{footer}}}
</body>

</html>