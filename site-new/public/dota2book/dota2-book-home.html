<html>

<head>
    {{{head}}}

    <style>
        .section-background {
            background-image: url('/dota2book/images/immortals_bg.jpg');
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            margin-top: 80px;
            margin-bottom: -20px;
        }

        .player-details {
            background-color: #242029;
            margin-top: 10px;
            margin-bottom: 10px;
            padding: 10px 20px;
            border-radius: 10px
        }

        .see-rankings {
            display: block;
            background-image: url('/dota2book/images/green-book-logo.png');
            height: 130px;
            margin-top: 10px;
            margin-bottom: 10px;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            padding-top: 45px;
            border-radius: 20px
        }

        .see-rankings-text {
            color: white;
            text-decoration: none;
        }

        .see-rankings-text:hover {
            text-decoration: none;
            color: lightgray;
        }

        .bet-box {
            background-color: #202d4f;
            border: 2px solid #38486d;
            border-radius: 10px;
            margin-bottom: 10px
        }

        .bet-box .first-team-row {
            /* background-color: #202d4f; */
            border-top-right-radius: 10px;
            border-top-left-radius: 10px;
        }

        .bet-box .first-team-row.selected {
            background-color: orange;
            border-top-right-radius: 10px;
            border-top-left-radius: 10px
        }

        .bet-box .first-team-row.correct {
            background-color: greenyellow;
            border-top-right-radius: 10px;
            border-top-left-radius: 10px
        }

        .bet-box .first-team-row.wrong {
            background-color: #a00;
            border-top-right-radius: 10px;
            border-top-left-radius: 10px
        }

        .bet-box .second-team-row {
            /* background-color: #202d4f; */
            border-top: 2px solid #38486d;
        }

        .second-team-row.selected {
            background-color: orange;
            border-top: 2px solid #38486d;
        }

        .second-team-row.correct {
            background-color: greenyellow;
            border-top: 2px solid #38486d;
        }

        .second-team-row.wrong {
            background-color: #a00;
            border-top: 2px solid #38486d;
        }


        .bet-box .team-images {
            width: 100%;
            padding: 6px
        }

        .book-radio-container {
            display: block;
            position: relative;
            margin-top: 20px;
            margin-right: 10px;
            padding-left: 35px;
            margin-bottom: 12px;
            cursor: pointer;
            font-size: 22px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Hide the browser's default radio button */
        .book-radio-container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        /* Create a custom radio button */
        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 25px;
            width: 25px;
            background-color: #eee;
            border-radius: 50%;
        }

        /* On mouse-over, add a grey background color */
        .book-radio-container:hover input~.checkmark {
            background-color: #ccc;
        }

        /* When the radio button is checked, add a blue background */
        .book-radio-container input:checked~.checkmark {
            background-color: orange;
        }

        .book-radio-container .checkmark.selected {
            background-color: orange;
        }

        /* Create the indicator (the dot/circle - hidden when not checked) */
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        /* Show the indicator (dot/circle) when checked */
        .book-radio-container input:checked~.checkmark:after {
            display: block;
        }

        /* Style the indicator (dot/circle) */
        .book-radio-container .checkmark:after {
            top: 9px;
            left: 9px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
        }


        .bet-box .team-names {
            color: white;
            font-weight: bold;
            font-size: 18px;
            margin-top: 22px;
        }

        .bet-box .coin-row {
            /* background-color: #202d4f; */
            border-top: 2px solid #38486d;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            padding: 10px 20px;
        }


        .bet-box .error {
            position: relative;
            display: inline-block;
            width: 50%;
            margin-right: 20px;

        }

        .bet-box .message-row {
            padding: 5px 10px;
            color: crimson;
        }

        .bet-box.not-active {
            background-color: #bbb;
            border-color: 2px solid #ddd;
        }

        .bet-box.not-active .second-team-row {
            border-color: #ccc;
        }

        .bet-box.not-active .coin-row {
            border-color: #ccc;
        }

        .bet-box .form-control[readonly] {
            background-color: #ccc;
            border: 3px solid #aaa;
        }

        .social-box {
            background-color: #202d4f;
            border: 2px solid #38486d;
            border-radius: 10px;
            padding-bottom: 10px;
            width: 30%;
            height: 310px;
            display: inline-block;
        }

        .profile-link {
            color: orange;
            font-size: 12px
        }

        .profile-link:hover {
            color: rgb(201, 147, 47);
            text-decoration: none
        }

        .check-and-coins-row {
            border-top: 2px solid #38486d;
            padding: 10px 10px;
        }

        @media (max-width: 576px) {
            .section-background {
                height: 1800px
            }

            .social-box {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    {{{navbar}}}
    <section class="section-background">
        <div class="container">
            <div class="row">
                <div class="col-md-4 col-12">
                    <div class="player-details">
                        <div class="row">
                            <div class="col-md-4 col-4">
                                <img src="/dota2book/images/Ti9_battle_pass.png" style="width:100%" alt="">
                            </div>
                            <div class="col-md-8 col-8">
                                <h2 style="color:white;font-weight: bold">{{currentUser.username}}</h2>
                                <h6 style="color: white">رتبه:??</h6>
                                <h6 style="color:orange">سکه:&nbsp;<span>{{currentUser.dota2Book2019.coins}}</span></h6>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4"></div>
                <div class="col-md-4 col-12">
                    <a class="see-rankings text-center" href="{{#SITE_URL}}/dota2-book/leaderboard{{/SITE_URL}}">
                        <span class="see-rankings-text" href="#">مشاهده رتبه بندی‌ها</span>
                    </a>
                </div>
            </div>
            <h2 style="color:white;margin-bottom: 10px">بازی های گروهی&nbsp;<span class="text-english">ESL One
                    Birmingham 2019</span></h2>
            <p style="color:white">به مرحله بازی های گروهی خوش آمدید برای هر مسابقه نتیجه را پیش بینی کنید در صورتی که
                پیش بینی شما درست
                باشد همان تعداد سکه برنده می شوید در صورتی که اشتباه باشد سکه ای از دست نمی دهید دقت داشته باشید که پس
                از ثبت امکان تغییر انتخاب ها وجود ندارد.</p>
            <h3 style="color:white">گروه A:</h3>
            <div class="alert alert-warning" id="bets-warning" style="display:none">
                <span class="fas fa-exclamation-circle"></span>
                <b>هشدار:</b>&nbsp;
                <span name="message">^_^</span>
            </div>
            <form action="/dota2-book/submit-bets" method="POST">
                <div class="row" id="group-a"></div>
                <h3 style="color:white">گروه B:</h3>
                <div class="row" id="group-b"></div>
                <input type="submit" class="btn btn-md btn-warning" value="ثبت پیش بینی ها" />
            </form>
            <script>
                //create data , functions:
                let coinsShowVal = 0;
                const ESL_TEAMS = JSON.parse(`{{{ESL_TEAMS}}}`);
                const GROUP_A_TOKENS = JSON.parse(`{{{GROUP_A}}}`);
                const GROUP_B_TOKENS = JSON.parse(`{{{GROUP_B}}}`);
                const GROUP_A = [], GROUP_B = [];
                for (var i = 0; i < GROUP_A_TOKENS.length; i++)
                    GROUP_A.push(getTeam(GROUP_A_TOKENS[i]));
                for (var i = 0; i < GROUP_B_TOKENS.length; i++)
                    GROUP_B.push(getTeam(GROUP_B_TOKENS[i]));
                console.log(ESL_TEAMS);
                const ALL_BETS = JSON.parse(`{{{ALL_BETS}}}`);
                const currentUser = {
                    _id: `{{currentUser._id}}`,
                    username: `{{currentUser.username}}`,
                    token: `{{{currentUser.token}}}`,
                    dota2Book2019: JSON.parse(`{{{DOTA2_BOOK_2019}}}`)
                };
                console.log(currentUser);
                // let actions = [];
                // for (var i = 0; i < GROUP_B.length-1; i++)
                // {
                //     for (var j = i + 1; j < GROUP_B.length; j++)
                //     {
                //         let a = GROUP_B[i];
                //         let b = GROUP_B[j];
                //         // console.log(a);
                //         actions.push({ active: true, token: 'matchup_'+a.token+'_vs_'+b.token, reward: -1, isBet: true, maxCoins: 100, answer: undefined, options: [a.token,b.token] });
                //     }
                // }
                // console.log(JSON.stringify(actions));
                $(() =>
                {
                    //render all group stage bets:
                    for (var i = 0; i < GROUP_A.length; i++)
                    {
                        for (var j = i + 1; j < GROUP_A.length; j++)
                        {
                            render_bet('#group-a', GROUP_A[i], GROUP_A[j]);
                        }
                    }
                    for (var i = 0; i < GROUP_B.length; i++)
                    {
                        for (var j = i + 1; j < GROUP_B.length; j++)
                        {
                            render_bet('#group-b', GROUP_B[i], GROUP_B[j]);
                        }
                    }
                    //check all of coin inputs:
                    $(".bet-box input[type=number]").change(function ()
                    {
                        let val = parseInt($(this).val());
                        let betToken = $(this).attr('betToken');
                        let bet = getBet(betToken);
                        if (val < 0)
                        {
                            $(this).closest(".bet-box").find(".message-row span").html('مقدار منفی صحیح نمی باشد.');
                        }
                        else if (val > bet.maxCoins)
                        {
                            $(this).closest(".bet-box").find(".message-row span").html('خطا بیش از حد مجاز سکه وارد کرده اید.');
                        }
                        else if (val > currentUser.dota2Book2019.coins)
                        {
                            $(this).closest(".bet-box").find(".message-row span").html('خطا بیش از موجودی خود سکه وارد کرده اید.');
                        }
                        else
                        {
                            $(this).closest(".bet-box").find(".message-row span").html('');
                        }
                        //check if we are not passing max-coins:
                        let allBetBoxes = $(".bet-box input[type=number]");
                        let coinsSum = 0;
                        for (var i = 0; i < allBetBoxes.length; i++)
                        {
                            let v = parseInt($(allBetBoxes[i]).val());
                            if (v > 0 && !isNaN(v))
                                coinsSum += v;
                        }
                        if (coinsSum > currentUser.dota2Book2019.coins)
                        {
                            $("#bets-warning").show();
                            $("#bets-warning [name=message]").html('بیشتر از سکه های موجودی خود وارد کرده اید.');
                        }
                        else
                            $("#bets-warning").hide();
                    });
                    $(".bet-box input[type=radio]").change(function ()
                    {
                        let betToken = $(this).attr('name');
                        let bet = getBet(betToken);
                        let coins = parseInt($(`.bet-box[betToken=${bet.token}] input[type=number]`).val());
                        if (coins <= 0 || isNaN(coins))
                        {
                            $(this).closest(".bet-box").find(".message-row span").html('مقدار سکه ها را نیز وارد کنید.');
                        }
                    });
                });
                //data functions:
                function getTeam(token)
                {
                    for (var i = 0; i < ESL_TEAMS.length; i++)
                        if (ESL_TEAMS[i].token == token)
                            return ESL_TEAMS[i];
                    return undefined;
                }
                function getBet(token)
                {
                    for (var i = 0; i < ALL_BETS.length; i++)
                        if (ALL_BETS[i].token == token)
                            return ALL_BETS[i];
                    return undefined;
                }
                function getUserBet(token)
                {
                    for (var i = 0; i < currentUser.dota2Book2019.bets.length; i++)
                    {
                        if (currentUser.dota2Book2019.bets[i].token == token)
                            return currentUser.dota2Book2019.bets[i];
                    }
                    return undefined;
                }
                //render functions:
                function render_bet(parent, teamA, teamB)
                {
                    let betToken = 'matchup_' + teamA.token + '_vs_' + teamB.token;
                    let bet = getBet(betToken);
                    if(bet == undefined)
                        return;
                    let userBet = getUserBet(betToken);
                    let optionA = ``, optionB = ``, optionAStatus = '', optionBStatus = '';
                    if (bet.active)
                    {
                        if (userBet == undefined)
                        {
                            optionA = `<label class="book-radio-container">
                                        <input type="radio"  value="${teamA.token}" name="${bet.token}">
                                        <span class="checkmark"></span>
                                    </label>`;
                            optionB = `<label class="book-radio-container">
                                        <input type="radio" value="${teamB.token}" name="${bet.token}">
                                        <span class="checkmark"></span>
                                    </label>`;
                        }
                        else
                        {
                            console.log('hey look we have this bet!');
                            optionA = `<label class="book-radio-container">
                                        <!--<input type="radio" readonly ${userBet.value == teamA.token ? 'selected' : ''}  value="${teamA.token}" name="${bet.token}">-->
                                        <span class="checkmark ${userBet.value == teamA.token ? 'selected' : ''}"></span>
                                    </label>`;
                            optionB = `<label class="book-radio-container">
                                        <!-- <input type="radio" readonly ${userBet.value == teamB.token ? 'selected' : ''} value="${teamB.token}" name="${bet.token}"> -->
                                        <span class="checkmark ${userBet.value == teamB.token ? 'selected' : ''}"></span>
                                    </label>`;
                        }
                    }
                    else
                    {
                        if (userBet == undefined)
                        {
                            optionA = `<label class="book-radio-container">
                                        <span class="checkmark"></span>
                                    </label>`;
                            optionB = `<label class="book-radio-container">
                                        <span class="checkmark"></span>
                                    </label>`;
                        }
                        else
                        {
                            console.log('hey look we have this  not active bet!');
                            optionA = `<label class="book-radio-container">
                                        <span class="checkmark ${userBet.value == teamA.token ? 'selected' : ''}"></span>
                                    </label>`;
                            optionB = `<label class="book-radio-container">
                                        <span class="checkmark ${userBet.value == teamB.token ? 'selected' : ''}"></span>
                                    </label>`;
                        }
                    }
                    let message = '';
                    if (!bet.active)
                    {
                        if (isEmptyString(bet.answer))
                        {
                            message = 'مهلت پیش بینی این مسابقه تمام شده است.';
                            optionAStatus = userBet != undefined && userBet.value == teamA.token ? 'selected' : '';
                            optionBStatus = userBet != undefined && userBet.value == teamB.token ? 'selected' : ''
                        }
                        else
                        {
                            if (userBet == undefined)
                                message = 'مهلت پیش بینی این مسابقه تمام شده است.' + '<br>' + 'شما نتیجه این مسابقه را پیش بینی نکردید.';
                            else
                            {
                                if (bet.answer == userBet.value)
                                    message = '<span style="color:green">' + 'شما نتیجه این مسابقه را به درستی پیش بینی کردید.' + '</span>';
                                else
                                    message = 'شما نتیجه این مسابقه را به اشتباه پیش بینی کردید.';
                                if (userBet.value == teamA.token)
                                {
                                    if (bet.answer == teamA.token)
                                        optionAStatus = 'correct';
                                    else
                                        optionAStatus = 'wrong';
                                }
                                if (userBet.value == teamB.token)
                                {
                                    if (bet.answer == teamB.token)
                                        optionBStatus = 'correct';
                                    else
                                        optionBStatus = 'wrong';
                                }
                            }
                        }
                    }


                    $(parent).append(`
                        <div class="col-md-4 col-12">
                            <div class="bet-box ${bet.active ? '' : 'not-active'}" teamA="${teamA.token}" teamB="${teamB.token}" betToken="${bet.token}">
                                <div class="first-team-row ${optionAStatus}">
                                    <div class="row">
                                        <div class="col-md-2 col-2">
                                            ${optionA}
                                        </div>
                                        <div class="col-md-3 col-3">
                                            <img src="/dota2book/images/team-secret-circle.png" class="team-images" alt="${teamA.name}">
                                        </div>
                                        <div class="col-md-7 col-7">
                                            <h4 class="team-names">${teamA.name}</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="second-team-row ${optionBStatus}">
                                    <div class="row">
                                        <div class="col-md-2 col-2">${optionB}</div>
                                        <div class="col-md-3 col-3">
                                            <img src="/dota2book/images/team-secret-circle.png" class="team-images" alt="${teamB.name}">
                                        </div>
                                        <div class="col-md-7 col-7">
                                            <h4 class="team-names">${teamB.name}</h4>
                                        </div>
                                    </div>
                                </div>
                                <div class="coin-row">
                                    <div style="position: relative;display:inline-block;width: 40%">
                                        <img style="position: absolute;width: 25%" src="/dota2book/images/coins.png" />
                                        <input type="number" name="${bet.token}-betCoins"  value="${userBet != undefined ? userBet.coins : ''}" placeholder="سکه‌ها" betToken="${bet.token}" ${bet.active ? '' : 'readonly'} ${userBet != undefined ? 'readonly' : ''} class="form-control" style="padding-right:30px;padding-bottom:3px;width: 100%;border-radius: 5px" />
                                    </div>
                                    <div class="error">
                                        <img style="width: 20%;display: inline-block;" src="/dota2book/images/error.png" />
                                        <h6 style="display: inline-block;color: white">حداکثر ${bet.maxCoins} سکه</h6>
                                    </div>
                                </div>
                                <div class="message-row">
                                    <span>${message}</span>    
                                </div>
                            </div>
                        `);
                }
            </script>
            <h1 style="color:white">سکه میخوای؟</h1>
            <div class="social-box">
                <div class="text-center">
                    <img src="/dota2book/images/ig-logo.png" style="width:40%;padding-top: 10px" alt="">
                    <h6 style="color:white;margin-top: 10px">صفحه اینستاگرام واج را دنبال کنید</h6>
                </div>
                <p style="color:lightgrey;font-size: 12px;padding-right: 10px">به بخش <span><a href="#"
                            class="profile-link"> ویرایش مشخصات
                            کاربری </a></span>رفته و آیدی اینستاگرام
                    خود را وارد کنید و صفحه اینستاگرام مارا دنبال کنید،سپس دکمه بررسی را فشار دهید.</p>
                <div class="check-and-coins-row">
                    <div style="position: relative;display:inline-block;width: 40%">
                        <img style="position: absolute;width: 25%;padding-top: 4px" src="/dota2book/images/coins.png" />
                        <button type="button" class="btn btn-success"
                            style="padding-right: 30px;width: 100%;font-size: 14px">جایزه 100 سکه</button>
                    </div>
                    <div style="position: relative;display:inline-block;width: 40%">
                        <a  href="/dota2-book/check-instagram"type="button" class="btn btn-warning"
                            style="width: 100%;font-size: 14px;margin-right: 50px">بررسی</a>
                    </div>
                </div>
            </div>
            <div class="social-box" style="margin-top: 10px">
                <div class="text-center">
                    <img src="/dota2book/images/twitch-logo.png" style="width:40%;padding-top: 10px" alt="">
                    <h6 style="color:white;margin-top: 10px">صفحه اینستاگرام واج را دنبال کنید</h6>
                </div>
                <p style="color:lightgrey;font-size: 12px;padding-right: 10px">به بخش <span><a href="#"
                            class="profile-link"> ویرایش مشخصات
                            کاربری </a></span>رفته و آیدی اینستاگرام
                    خود را وارد کنید و صفحه اینستاگرام مارا دنبال کنید،سپس دکمه بررسی را فشار دهید.</p>
                <div class="check-and-coins-row">
                    <div style="position: relative;display:inline-block;width: 40%">
                        <img style="position: absolute;width: 25%;padding-top: 4px" src="/dota2book/images/coins.png" />
                        <button type="button" class="btn btn-success"
                            style="padding-right: 30px;width: 100%;font-size: 14px">جایزه 100 سکه</button>
                    </div>
                    <div style="position: relative;display:inline-block;width: 40%">
                        <button type="button" class="btn btn-warning"
                            style="width: 100%;font-size: 14px;margin-right: 50px">بررسی</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    {{{footer}}}
</body>

</html>