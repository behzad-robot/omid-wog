<html>

<head>
    {{{head}}}
    <!-- SEO -->
    <title>{{post.title}} - واج</title>
    <meta name="description" content="{{post._seo.metaDescription}}">
    <meta name="keywords" itemprop="keywords" content="{{post._seo.keywords}}">
    <link rel="canonical" href="{{post.siteUrl}}">

    <meta property="og:locale" content="fa_IR">
    <meta property="og:type" content="article">
    <meta property="og:title" content="{{post.title}} - واج">
    <meta property="og:description" content="{{post._seo.metaDescription}}">
    <meta property="og:url" content="{{post.siteUrl}}">
    <meta property="og:image" content="{{post.thumbnail}}">
    <meta property="og:site_name" content="واج">

    <meta property="article:section" content="{{post._cats[0].name}}">
    <meta property="article:published_time" content="{{post.createdAt}}">
    <meta property="article:published_time" content="{{post.createdAt}}">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@wogcompany">
    <meta name="twitter:description" content="{{post._seo.metaDescription}}">
    <meta name="twitter:title" content="{{post.title}}">
    <meta name="twitter:image" content="{{post.thumbnail_640x480}}">

    <!-- End SEO -->
    <style>
        .post-single-header {
            width: 100%;
            display: block;
            height: 36vw;
            background-size: cover;
            background-position: center;
            padding-top: 10vw;
            position: relative;
        }

        .post-single-header h1 {
            font-size: 55px;
            font-weight: bold;
            text-align: center;
            color: white;
            text-shadow: 3px 4px 6px rgba(0, 0, 0, 0.45);
        }

        .post-single-header .author-box {
            width: 20%;
            margin: 0px auto;
            margin-top: 45px;
            background-color: rgba(0, 0, 0, .3);
            /* border-top: 1px solid white; */
            /* border: 1px solid white; */
            padding: 5px 25px;
            color: white;
            border-radius: 68px;
            box-shadow: 1px 6px 17px rgba(0, 0, 0, 0.4);
            font-size: 13px;
            text-shadow: 1px 2px 2px rgba(0, 0, 0, 1);
        }

        .post-single-header .author-box .author-profile-image {
            width: 48px;
            height: 48px;
            border-radius: 50%;

        }

        .post-single-header .author-box .author-name {
            margin: 0 10px;
        }

        .post-single-header .author-box .date {
            float: left;
            margin-top: 15px;
        }

        .post-single-header .cats-box {
            width: 16%;
            margin: 30px auto;
        }

        .post-single-header .cats-box .btn.btn-sm {
            font-size: 0.8em;
        }

        .contentSection {
            padding-top: 30px;
            padding-bottom: 20px;
            line-height: 2rem;
            font-size: 14px;
        }

        .contentSection img {
            max-width: 100%;
        }

        .wog-image-with-caption {
            display: block;
            margin: 10px auto;
            text-align: center;
        }

        .wog-image-with-caption img {
            display: inline;
        }

        .wog-image-with-caption p {
            display: block;
        }

        .suggested-post-box {
            display: block;
            color: #2e2e2e;
            text-decoration: none !important;
        }

        .suggested-post-box:hover {
            color: orange;
        }

        .suggested-post-box h1 {
            font-size: 1.1rem;
            padding: 5px;
            margin: 5px 0;
        }

        .comment-box {
            padding: 10px 20px;
        }

        .comment-box .profile-image {
            display: inline-block;
            width: 48px;
            border: 1px solid orange;
            padding: 2px;
            vertical-align: top;
        }

        .comment-box .comment-main-part {
            display: inline-block;
            width: auto;
            max-width: 100%;
            padding: 5px 10px;
        }

        .comment-box .comment-footer {
            display: block;
            width: 60%;
            margin: 0 auto;
            margin-top: 20px;
            border-bottom: 1px solid #3e3e3e;
        }

        .img-100p {
            width: 100%;
            height: auto;
        }

        .img-80p {
            width: 80%;
            height: auto;
        }

        .img-60p {
            width: 60%;
            height: auto;
        }

        @media (max-width: 576px) {
            .post-single-header {
                height: 70vh;
            }

            .post-single-header h1 {
                font-size: 36px;
            }

            .post-single-header .author-box {
                width: 90%;
                margin: 0 auto;
                padding: 0;
            }

            .post-single-header .cats-box {
                width: 90%;
            }

            .img-80p {
                width: 100%;
            }

            .img-60p {
                width: 80%;
            }
        }
    </style>
</head>

<body>
    {{{navbar}}}
    <navfiller></navfiller>
    <section class="post-single-header" style="background-image:url('{{post.thumbnail}}')">
        <div
            style="position:absolute;width: 100%;height: 100%;z-index:0;background-color:rgba(0, 0, 0, .2);top:0;left:0;">
        </div>
        <div style="position:relative;z-index:0;">
            <h1 id="post-title">{{{post.title_formatted}}}</h1>
            <script>
                // $(()=>{
                //     var title = $("#post-title").html();
                //     for(var i = 0 ; i < 10;i++){
                //         title = title.replace(i.toString(),`<span class="text-english">${i}</span>`);
                //     }
                //     $("#post-title").html(title);
                // });
            </script>
            <div class="author-box">
                <img src="{{post._author.profileImage}}" class="author-profile-image" />
                <span class="author-name"><b>نویسنده:&nbsp;</b><a style="color:white !important;"
                        href="{{post._author.siteUrl}}"><span>{{post._author.username}}</span></a></span>
                <span class="date">{{post.createdAt_persian}}</span>
            </div>
            <div class="cats-box">
                <!-- <b class="text-white text-shadow"
                    style="font-size:14px;font-weight: bolder;display:block;margin-bottom:5px;">دسته بندی ها:</b> -->
                {{#post._cats}}
                <a href="{{siteUrl}}" class="btn btn-sm btn-warning"
                    style="font-size:13px;font-weight:bold;margin:2px;">{{name}}</a>
                {{/post._cats}}
            </div>
        </div>

    </section>
    <section style="background-color:#1e1e1e;height:5px;margin-bottom:10px"></section>
    <section class="bg-section contentSection">
        <div class="container">
            <div class="row">
                <div class="col-md-1 col-12"></div>
                <div class="col-md-10 col-12">
                    {{{post.body}}}
                </div>
                <div class="col-md-1 col-12"></div>
            </div>

        </div>
    </section>
    <section class="bg-section">
        <div class="container">
            <div>
                <h3 style="font-size:1.2rem;">تگ ها:</h3>
                {{#post.tags}}
                <a href="{{#SITE_URL}}/posts/tags/{{.}}{{/SITE_URL}}" class="btn btn-sm btn-warning"
                    style="font-size:0.7rem;">{{.}}</a>
                {{/post.tags}}
            </div>
        </div>
        <hr>
    </section>
    <script>
        // $(() =>
        // {
        //     $(".contentSection img").css('width', '100%');
        //     $(".contentSection img").css('height','auto');
        // });
    </script>
    <section class="bg-section" style="padding:20px 0">
        <div class="container">
            <h3
                style="margin-bottom:20px;;width: fit-content;color: #4e4e4e;font-weight: bold;;border-radius: 3px;">
                دیگر مطالب پیشنهادی:</h3>
            <div class="row">
                {{#recommendedPosts}}
                <div class="col-md-3">
                    <a class="suggested-post-box" href="{{siteUrl}}">
                        <img src="{{thumbnail_640x480}}" width="100%" />
                        <h1>{{title}}</h1>
                    </a>
                </div>
                {{/recommendedPosts}}
            </div>
        </div>

    </section>
    <section class="comments-section">
        <div class="container">
            <!-- <h2 class="orange-title" style="font-size:1.2rem;">ارسال نظر:</h2> -->
            <h2 style="color:#79848f"> متن دیدگاه</h2>
            {{#currentUser}}
            <form action="/comments/new" method="POST" id="new-comment-form">
                <textarea class="form-control dark" name="body" style="width:50%;height:200px;"
                    placeholder="دیدگاه خود را وارد کنید"></textarea>
                <input type="hidden" name="objectType" value="posts" />
                <input type="hidden" name="objectId" value="{{post._id}}" />
                <input type="submit" class="btn btn-md btn-warning" style="margin:10px 0;" value="ارسال دیدگاه" />
            </form>
            <script>
                $(() =>
                {
                    $("#new-comment-form").ajaxForm(
                        {
                            beforeSubmit: (formData, jqForm, options) =>
                            {
                                var str = $("#new-comment-form [name=body]").val();
                                str = str.replaceAll(' ', '').replaceAll('\n', '').replaceAll('<br>', '');
                                if (str == '')
                                {
                                    alert('لطفا متن نظر را وارد کنید.');
                                    return false;
                                }
                                return true;
                            },
                            success: (text, code, xhr, form) =>
                            {
                                if (typeof text == 'string')
                                    text = JSON.parse(text);
                                if (text.error)
                                {
                                    alert(text.error);
                                    return;
                                }
                                var comment = text.comment;
                                if (comment._draft == true)
                                {
                                    alert('با تشکر نظر شما با موفقیت ثبت شد و پس از بررسی مدیر سایت نمایش داده میشود.');
                                }
                                else
                                {
                                    alert('نظر شما با موفقیت ثبت شد.');
                                    $("#comments-list").append(`
                                        <div class="comment-box" id="comment-${comment._id}">
                                            <div class="profile-image">
                                                <img src="{{currentUser.profileImage}}" width="100%" />
                                            </div>
                                            <div class="comment-main-part">
                                                <div class="top-info">
                                                    <a class="link-yellow" href="#">{{currentUser.username}}</a>&nbsp;
                                                    |
                                                    <small class="date">${comment.createdAt_persian}</small>
                                                </div>
                                                <div class="comment-body">${comment.body}</div>
                                            </div>
                                            <div class="comment-footer"></div>
                                        </div>
                                        `);
                                    scroll_to(`#comment-${comment._id}`);
                                    $("#no-comments").hide();
                                }
                                $("#new-comment-form").clearForm();
                            },
                            error: (xhr, text, err) =>
                            {
                                alert('خطا از سمت سرور');
                                console.log(text);
                                console.log(err);
                            },
                        });
                });
            </script>
            {{/currentUser}}
            {{^currentUser}}
            <div>
                <textarea class="form-control dark" name="body" style="width:50%;height:200px;margin-bottom:10px;"
                    placeholder="دیدگاه خود را وارد کنید"></textarea>
                <p class="btn btn-md btn-black"><span>برای ارسال نظر ابتدا باید <a
                            href="{{#SITE_URL}}/login{{/SITE_URL}}" class="link-yellow">وارد</a> سایت شوید.</span></p>
            </div>
            {{/currentUser}}
            <h2 style="font-size:1.2rem;">نظرات کاربرها:</h2>
            <div id="comments-list">
                {{#comments}}
                <div class="comment-box" id="comment-{{_id}}">
                    <div class="profile-image">
                        <img src="{{_user.profileImage}}" width="100%" />
                    </div>
                    <div class="comment-main-part">
                        <div class="top-info">
                            <a class="link-yellow" href="{{_user.siteUrl}}">{{_user.username}}</a>&nbsp;
                            |
                            <small class="date">{{createdAt_persian}}</small>
                        </div>
                        <div class="comment-body">
                            {{body}}
                        </div>

                    </div>
                    <div class="comment-footer"></div>
                </div>
                {{/comments}}
                {{^comments}}
                <div class="text-center" id="no-comments">هیچ نظری برای این مطلب ثبت نشده.</div>
                {{/comments}}
            </div>
        </div>
    </section>
    {{{footer}}}
</body>

</html>