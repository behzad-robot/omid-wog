<navbar class="">
    <div class="container" style="height:100%;overflow: hidden;">
        <div class="navbar-mobile-btn-wrapper">
            <div class="btn btn-md btn-dark" style="margin-top:10px;">
                <span><i class="fas fa-bars"></i></span>
            </div>
        </div>
        <div style="display:inline-block">
            <a href="/home">
                <img src="/images/wog-orange-logo.png" class="navbar-logo" />
            </a>
            <img src="/images/beta-version.png" class="navbar-beta no-tablet" />
        </div>

        <div class="navbar-links-container">
            <div class="btn btn-md navbar-item navbar-links-back-btn"><span class="fas fa-arrow-right"></span></div>
            <a href="/tournaments" class="navbar-item">مسابقات</a>
            <a href="/posts/categories/news" class="navbar-item" dropdownItem="news">اخبار<span
                    class="fas fa-sort-down"></span></a>
            <a href="/posts/categories/articles" class="navbar-item" dropdownItem="tutorials">مقالات<span
                    class="fas fa-sort-down"></span></a>

            <a href="/wiki" class="navbar-item" dropDownItem="games-disabledd">بازی‌ها
                <!--<span class="fas fa-sort-down"></span>--></a>
            <!-- <a href="/shop" class="navbar-item">فروشگاه</a> -->
            <!-- {{^currentUser.accessLevel.isAdmin}}
            <a href="/about-us" class="navbar-item">درباره ما</a>
            <a href="/contact-us" class="navbar-item">تماس با ما</a>
            {{/currentUser.accessLevel.isAdmin}} -->
            {{#currentUser}}
            <!-- ^_^ put 3 social icons shit here i guess!-->
            <a href="/social"  class="navbar-item text-center no-tablet"
                data-toggle="tooltip" data-placement="bottom" title="خانه شبکه اجتماعی">
                <i class="fab fa-hotjar" style="font-size: 25px;top:5px;right:0"></i>
                <span class="mobile-only-inline" style="margin-right: 7px">خانه شبکه اجتماعی</span>
            </a>
           
            <a href="/social/explore" class="navbar-item text-center no-tablet"
            data-toggle="tooltip" data-placement="bottom" title="تازه ها">
                <i class="fas fa-compass" style="font-size: 25px;top:5px;right:0"></i>
                <span class="mobile-only-inline" style="margin-right: 7px">تازه ها</span>
            </a>
            <a href="/social/chat" class="navbar-item text-center no-tablet"
            data-toggle="tooltip" data-placement="bottom" title="چت">
                <i class="fas fa-comments" style="font-size: 25px;top:5px;right:0"></i>
                <span class="mobile-only-inline" style="margin-right: 7px">چت</span>
            </a>
            <a href="#" onclick="toggleNotifications()" class="navbar-item text-center no-tablet"
            data-toggle="tooltip" data-placement="bottom" title="پیام ها">
                <i class="fas fa-bell" style="font-size: 25px;top:5px;right:0">
                    <span id="notifications-count"
                        style="color:white;background-color:red;width:16px;height:16px;display:none;border-radius:50%;position: absolute;font-size:10px;padding-top:3px;top:-5px;right:7px;">??</span>
                </i>

                <span class="mobile-only-inline" style="margin-right: 7px">پیام ها</span>
            </a>
            {{/currentUser}}
            {{^currentUser}}
            <a href="/login" class="navbar-item mobile-only">ورود</a>
            <a href="/signup" class="navbar-item mobile-only">ثبت نام</a>
            {{/currentUser}}
        </div>
        <script>
            $(() =>
            {
                $(".navbar-links-back-btn").click(() =>
                {
                    $(".navbar-links-container").hide();
                });
                $(".navbar-mobile-btn-wrapper .btn").click(() =>
                {
                    $(".navbar-links-container").show();
                });
            });
        </script>
        <div class="float-left">
            <div class="navbar-item text-center navbar-search-btn"><span class="fas fa-search" style=""></span></div>
            <div class="wog-card search-card" style="display:none">
                <form action="/posts/search/" method="GET" style="margin:0;padding:0">
                    <input name="s" class="form-control search-input" placeholder="جستجو..." />
                </form>
            </div>
        </div>
        <script>
            $(() =>
            {
                $(".navbar-search-btn").click(() =>
                {
                    $("navbar .search-card").slideToggle(300);
                });
            });
        </script>
        {{#currentUser}}
        <div class="navbar-user-box">
            <a href="/users/{{username}}/"><img src="{{profileImage}}" /></a>
            <div class="navbar-item" id="navbar-dropdownMenuButton" style="cursor:pointer;">
                <!--<a style="color:white !important;text-decoration: none !important;" href="{{siteUrl}}"></a>-->
                {{username}}
                <span class="fas fa-sort-down"></span>
            </div>
            <div class="dropdown-menu" id="navbar-dropdownMenu"
                style="float:unset;left:unset;direction:rtl;text-align: right">
                <a class="dropdown-item" href="/users/{{username}}/">پروفایل</a>
                <a class="dropdown-item" href="/users/{{username}}/edit">ویرایش اطلاعات کاربری</a>
                <a class="dropdown-item" href="/logout">خروج</a>
            </div>
            <script>
                $(() =>
                {
                    $("#navbar-dropdownMenuButton").click(() =>
                    {
                        $("#navbar-dropdownMenu").slideToggle(100);
                    })
                });
            </script>
        </div>
        {{/currentUser}}
        {{^currentUser}}
        <div class="float-left navbar-login-box" style="height:100%">
            <a href="/login" class="navbar-item">ورود</a>
            <a href="/signup" class="navbar-item">ثبت‌ نام</a>
        </div>
        {{/currentUser}}


    </div>
</navbar>
<div class="navbar-dropdown" dropDownItem="games-disabled" style="display:none;">
    <div class="container" style="pointer-events: all;">
        <img src="/images/navbar-games-tail.png" style="position: relative;right:200px;" width="48px" />
        <div class="card" style="background-color:#1F262A;color:white;height:450px;">
            <div class="row">

                <div class="col-md-3 text-english" style="padding-left:0;">
                    {{#navbarData.games}}
                    <a href="{{siteUrl}}" class="navbar-games-link selected" token="{{token}}">{{name}}<span
                            class="fas fa-chevron-left float-left"></span></a>
                    {{/navbarData.games}}
                    <!-- <a href="#" class="navbar-games-link">League Of Legends<span
                            class="fas fa-chevron-left float-left"></span></a>
                    <a href="#" class="navbar-games-link">Vain glory<span
                            class="fas fa-chevron-left float-left"></span></a>
                    <a href="#" class="navbar-games-link">Mortal Kombat nadarim<span
                            class="fas fa-chevron-left float-left"></span></a> -->
                </div>

                <div class="col-md-9" style="padding-right:0">
                    <div class="navbar-games-cover" style="background-image:url('/images/dota-2-wallpaper.jpg');">
                        <div class="gradient-thing">
                            <img src="/images/dota2-logo.png" width="128px" />
                            <h3>بازی Dota 2</h3>
                            <p style="width:400px;margin-top:15px;">
                                این بازی خیلی چرتی هست لورم ایپسوم متن پر کنندهاین بازی خیلی چرتی هست لورم ایپسوم متن پر
                                کننده این بازی خیلی چرتی هست لورم ایپسوم متن پر کنندهر این بازی خیلی چرتی هست لورم
                                ایپسوم متن پر کننده این بازی خیلی چرتی هست لورم ایپسوم متن پر کنندهاین بازی خیلی چرتی
                                هست لورم ایپسوم متن پر کننده این بازی خیلی چرتی هست لورم ایپسوم متن پر کننده
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- <div class="navbar-dropdown" dropDownItem="tutorials" style="display:none;">
    <div class="container" style="pointer-events: all;">
        <img src="/images/navbar-games-tail.png" style="position: relative;right:200px;" width="48px" />
        <div class="card" style="background-color:#1F262A;color:white;height:450px;">
            <div class="row">

                <div class="col-md-3" style="padding-left:0;">
                    {{#navbarData.tutorials}}
                    <a href="{{siteUrl}}" class="navbar-games-link selected" slug="{{slug}}">{{name}}<span
                            class="fas fa-chevron-left float-left"></span></a>
                    {{/navbarData.tutorials}}
                </div>

                <div class="col-md-9" style="padding-right:0">
                    <div class="navbar-games-cover">
                        <div class="gradient-thing">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="navbar-post-box">
                                        <img src="/images/pubgcover.jpg" width="100%" />
                                        <h1>عنوان مطلب</h1>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="navbar-post-box">
                                        <img src="/images/pubgcover.jpg" width="100%" />
                                        <h1>عنوان مطلب</h1>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="navbar-post-box">
                                        <img src="/images/pubgcover.jpg" width="100%" />
                                        <h1>عنوان مطلب</h1>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="navbar-post-box">
                                        <img src="/images/pubgcover.jpg" width="100%" />
                                        <h1>عنوان مطلب</h1>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="navbar-post-box">
                                        <img src="/images/pubgcover.jpg" width="100%" />
                                        <h1>عنوان مطلب</h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> -->
<div class="navbar-dropdown" dropDownItem="news" style="display:none;">
    <div class="container" style="pointer-events: all;">
        <img src="/images/navbar-games-tail.png" style="position: relative;right:300px;" width="48px" />
        <div class="card" style="background-color:#1F262A;color:white;height:450px;">
            <div class="row">

                <div class="col-md-3" style="padding-left:0;">
                    {{#navbarData.news}}
                    <a href="{{siteUrl}}" class="navbar-games-link" slug="{{slug}}">{{name}}<span
                            class="fas fa-chevron-left float-left"></span></a>
                    {{/navbarData.news}}
                </div>

                <div class="col-md-9" style="padding-right:0">
                    <div class="navbar-games-cover">
                        <div class="gradient-thing no-gradient" id="news-posts-container">
                            {{#navbarData.news}}
                            <div class="row navbar-posts-row" cat="{{slug}}">
                                {{#posts}}
                                <div class="col-md-4">
                                    <a class="navbar-post-box" href="{{siteUrl}}">
                                        <div class="navbar-post-thumbnail"
                                            style="background-image:url('{{thumbnail_640x480}}')"></div>
                                        <h1>{{title}}</h1>
                                    </a>
                                </div>
                                {{/posts}}
                            </div>
                            {{/navbarData.news}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="navbar-dropdown" dropDownItem="tutorials" style="display:none;">
    <div class="container" style="pointer-events: all;">
        <img src="/images/navbar-games-tail.png" style="position: relative;right:400px;" width="48px" />
        <div class="card" style="background-color:#1F262A;color:white;height:450px;">
            <div class="row">
                <div class="col-md-3" style="padding-left:0;">
                    {{#navbarData.tutorials}}
                    <a href="{{siteUrl}}" class="navbar-games-link" slug="{{slug}}">{{name}}<span
                            class="fas fa-chevron-left float-left"></span></a>
                    {{/navbarData.tutorials}}
                </div>

                <div class="col-md-9" style="padding-right:0">
                    <div class="navbar-games-cover">
                        <div class="gradient-thing no-gradient" id="news-posts-container">
                            {{#navbarData.tutorials}}
                            <div class="row navbar-posts-row" cat="{{slug}}">
                                {{#posts}}
                                <div class="col-md-4">
                                    <a class="navbar-post-box" href="{{siteUrl}}">
                                        <div class="navbar-post-thumbnail"
                                            style="background-image:url('{{thumbnail_640x480}}')"></div>
                                        <h1>{{title}}</h1>
                                    </a>
                                </div>
                                {{/posts}}
                            </div>
                            {{/navbarData.tutorials}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(() =>
    {
        //navbar dropdowns:
        let currentDropDown = undefined;
        $(".navbar-item").mouseenter(function ()
        {
            let sw = $(window).width();
            if (sw <= 500)
                return;
            var dropDownItem = $(this).attr('dropDownItem');
            console.log(dropDownItem);
            if (dropDownItem == undefined)
                return;
            $(`.navbar-dropdown`).hide();
            $(`.navbar-dropdown[dropDownItem=${dropDownItem}]`).show();
            currentDropDown = dropDownItem;
        });
        $(".navbar-dropdown .container").mouseleave(function ()
        {
            console.log('mouse leave!');
            $(`.navbar-dropdown`).hide();
        });
        //news rows,buttons:
        let newsRows = $("[dropDownItem=news] .navbar-posts-row");
        for (var i = 1; i < newsRows.length; i++)
            $(newsRows[i]).hide();
        let newsButtons = $("[dropDownItem=news] .navbar-games-link");
        $(newsButtons[0]).addClass('selected');
        $("[dropDownItem=news] .navbar-games-link").mouseover(function ()
        {
            $("[dropDownItem=news] .navbar-games-link").removeClass('selected');
            $(this).addClass('selected');

            var slug = $(this).attr('slug');
            $("[dropDownItem=news] .navbar-posts-row").hide();
            $(`[dropDownItem=news] .navbar-posts-row[cat=${slug}]`).show();
        });
        //tutorials rows,buttons:
        let tutorialsRows = $("[dropDownItem=tutorials]  .navbar-posts-row");
        for (var i = 1; i < tutorialsRows.length; i++)
            $(tutorialsRows[i]).hide();
        let tutorialsButtons = $("[dropDownItem=tutorials] .navbar-games-link");
        $(tutorialsButtons[0]).addClass('selected');
        $("[dropDownItem=tutorials] .navbar-games-link").mouseover(function ()
        {
            $("[dropDownItem=tutorials] .navbar-games-link").removeClass('selected');
            $(this).addClass('selected');

            var slug = $(this).attr('slug');
            $("[dropDownItem=tutorials] .navbar-posts-row").hide();
            $(`[dropDownItem=tutorials] .navbar-posts-row[cat=${slug}]`).show();
        });
    });
</script>
<!-- {{^currentUser}}
<div style="position:fixed;height:100vh;width:100vw;top:0;left:0;z-index:9999999" id="epi-popup">
    <div style="position: absolute;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.8)" onclick="closeEpicenterPopUp()"></div>
    <div class="container" style="padding-top:100px;">
        <div class="row">
            <div class="col-md-2"></div>
            <div class="col-md-8">
                <div style="background-color:#414141;border-radius:5px;box-shadow:2px 2px 3px rgba(0, 0, 0, 0.3);">
                    <div style="width: 100%;position: relative">
                        <img src="/dota2-epic-center/images/epi3.jpg" width="100%"/>
                        <div style="position:absolute;top:50px;left:0;background-color:rgba(255, 110, 0, 0.8);color:white;padding:5px 10px">چهل میلیون ریال جایزه برای 10 نفر</div>
                        <div style="padding:10px 20px" class="text-center text-white">
                            <h2>پیش بینی مسابقات <span class="text-english">Epicenter 2019</span></h2>
                            <p>نتیجه مسابقات رو پیش بینی کن ایک باکس ببر!</p>
                            <a href="{{#SITE_URL}}/dota2-epic-center/landing{{/SITE_URL}}" class="btn btn-md btn-warning" style="font-size:14px;min-width:150px;background-color:orange !important;">مشاهده</a>
                            <div style="font-size:12px;margin-top:10px;text-decoration: underline;cursor: pointer;" onclick="closeEpicenterPopUp()">بازگشت به سایت</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function closeEpicenterPopUp(){
        $("#epi-popup").hide();
    }
</script>
{{/currentUser}} -->
{{#currentUser}}
<div class="notifications-wrapper" style="display: none;">
    <div class="container">
        <div class="notifications-box">
            <div class="text-center">
                <div id="notifications-loading" class="text-center">
                    <div class="lds-ellipsis">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </div>
                <div id="notifications-error" style="color:#a00;"></div>
            </div>
            <div id="notifications-list" style="height:100%;overflow-y:scroll;"></div>
        </div>
    </div>
</div>
<script>
    $(() =>
    {
        $(function ()
        {
            $('[data-toggle="tooltip"]').tooltip()
          
        })


        // readNotifications();
        $("#notifications-count").hide();
        fetch('/social/get-unread-notifications-count', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                userId: `{{{currentUser._id}}}`,
                userToken: `{{{currentUser.token}}}`,
            }),
        }).then(response => response.json()).then((response) =>
        {
            console.log(response);
            if (response.code != 200)
            {
                alert(response.error);
                console.log(response.error);
            }
            let count = response._data.notificationsCount;
            if (count != 0)
            {
                $("#notifications-count").show();
                $("#notifications-count").css('display', 'inline-block');
                $("#notifications-count").html();
            }
        });
    });

    function toggleNotifications()
    {
        let display = $(".notifications-wrapper").css('display');
        if (display == 'none')
        {
            $(".notifications-wrapper").show();

        }
        else
        {
            $(".notifications-wrapper").hide();
            return;
        }
        $("#notifications-loading").show();
        $("#notifications-error").html('');
        $("#notifications-list").html('');
        fetch('/social/read-notifications', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                userId: `{{{currentUser._id}}}`,
                userToken: `{{{currentUser.token}}}`,
            }),
        }).then(response => response.json()).then((response) =>
        {
            $("#notifications-loading").hide();
            console.log(response);
            if (response.code != 200)
            {
                $("#notifications-error").html(response.error);
                return;
            }
            let notifications = response._data;
            let body = '';
            for (var i = 0; i < notifications.length; i++)
            {
                let notif = notifications[i];
                if (notif.type == 'like-post')
                {
                    if (notif._post == undefined || notif._actionUser == undefined)
                        continue;
                    body = `<a href="${notif._actionUser.siteUrl}"><b>${notif._actionUser.username}</b></a> پست شما را پسندید.`;
                    $("#notifications-list").append(`
                        <div class="notif-item">
                            <a href="${notif._post.siteUrl}"><img class="notif-icon" src="${notif._post.thumbnail_150x150}"/></a>
                            <span class="notif-body">${body}</span>
                        </div>
                    `);
                }
                else if (notif.type == 'like-comment')
                {
                    if (notif._actionUser == undefined)
                        continue;
                    body = `<a href="${notif._actionUser.siteUrl}"><b>${notif._actionUser.username}</b></a> نظر شما را پسندید.`;
                    $("#notifications-list").append(`
                        <div class="notif-item">
                            <a href="/comments/${notif.commentId}"><span class="notif-glyph fas fa-comment"></span></a>
                            <span class="notif-body">${body}</span>
                        </div>
                    `);
                }
                else if (notif.type == 'follow-user')
                {
                    if (notif._actionUser == undefined)
                        continue;
                    body = `<a href="${notif._actionUser.siteUrl}"><b>${notif._actionUser.username}</b></a> شما را دنبال می کند.`;
                    $("#notifications-list").append(`
                        <div class="notif-item">
                            <a href="${notif._actionUser.siteUrl}"><img class="notif-icon" src="${notif._actionUser.siteUrl}"/></a>
                            <span class="notif-body">${body}</span>
                        </div>
                    `);
                }
                else if (notif.type == 'post-comment')
                {
                    if (notif._actionUser == undefined || notif._post == undefined)
                        continue;
                    body = `<a href="${notif._actionUser.siteUrl}"><b>${notif._actionUser.username}</b></a> برای پست شما نظری ارسال کرد.`;
                    $("#notifications-list").append(`
                        <div class="notif-item">
                            <a href="${notif._post.siteUrl}"><img class="notif-icon" src="${notif._post.thumbnail_150x150}"/></a>
                            <span class="notif-body">${body}</span>
                        </div>
                    `);
                }
            }
        }).catch((err) =>
        {
            $("#notifications-loading").hide();
            $("#notifications-error").html(err.toString());
        });
    }
</script>
{{/currentUser}}