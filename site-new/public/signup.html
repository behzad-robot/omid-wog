<html>

<head>
    {{{head}}}
    <title>ثبت نام</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <style>
        body {
            background-image: url('/images/fortnite-signup-wallpaper.jpg');
            background-size: cover;
            background-position: center;
        }

        .signup-section {
            width: 100%;
            height: 100vh;
            padding-top: 80px;
            background-position: center;
            background-size: cover;
            position: relative;
        }

        .input-field {
            background-color: #23313c;
        }

        .signup {
            background-color: #171c1f;
            margin-top: 40px;
            border-radius: 20px;
            padding: 20px;
        }

        .form-control.login-input {
            background-color: #21323a;
            color: white;
            box-shadow: none;
            width: 100%;
            height: 37px;
            margin-top: 10px;
            border-color: #171c1f;
            margin-top: 15px;
            border-radius: 20px;
        }

        .form-control.login-input:focus {
            border-color: orange;
            box-shadow: none;
            background-color: #2c414b;

        }
        .form-control.login-input.login-input-with-icon{
            display:inline-block;
            width: 85%;
        }

        .wogLogo {
            width: 30%;
        }

        .forget-link {
            text-decoration: none;
            color: grey;
        }

        .forget-link:hover {
            text-decoration: none;
            color: darkgrey
        }

        .signup-link {
            text-decoration: none;
            color: rgb(190, 124, 1);
        }

        .signup-link:hover {
            text-decoration: none;
            color: rgb(255, 177, 32);
        }

        .tittle {
            text-align: center;
            color: orange;
            font-size: 22px;
            margin: 15px 0;
        }

        .default-image {
            width: 30%;
            border-radius: 50px;
        }
    </style>
</head>

<body>
    {{{navbar}}}
    <section class="signup-section">
        <form id="signupForm" action="/signup" method="POST">
            <div class="container">
                <div class="row">
                    <div class="col-md-4"></div>
                    <div class="col-md-4 col-12 ">
                        <!-- fisrt step -->
                        <div class="signup" id="step1">
                            <div class="text-center"><img class="wogLogo" src="/images/wog-logo.png" alt=""></div>
                            <h1 class="tittle"> ثبت نام در واج</h1>
                            <input type="text" name="phoneNumber" class="form-control login-input"
                                placeholder="لطفا شماره همراه خود را وارد کنید">
                            <div class="text-center" style="padding:10px 0">
                                <div class="btn btn-md btn-warning" id="phoneNumber-submit-btn"
                                    onclick="phoneNumberSubmit()">بعدی</div>
                            </div>

                            <p id="error-phoneNumber" style=" color:red"></p>
                            <a href="/forget-password" class="forget-link" id="forgetpass"">
                                    <p>رمز عبور خود را فراموش کرده اید؟</p>
                                </a>
                                <a href="/login" class="signup-link">
                                <p>حساب کاربری دارید؟وارد شوید!</p>
                            </a>
                        </div>
                        <!-- end of first step -->
                        <!-- second step -->
                        <div class="signup" id="step2" style="display: none">
                            <div class="text-center"><img class="wogLogo" src="/images/wog-logo.png" alt=""></div>
                            <h1 class="tittle"> ثبت نام در واج</h1>
                            <input type="text" name="confirmCode" class="form-control login-input"
                                placeholder="کد تایید">
                            <div class="text-center" style="padding:10px 0;">
                                <div class="btn btn-md btn-warning" onclick="confirmCodeSubmit()">بعدی</div>
                            </div>
                            <p id="error-confirmCode" style=" color:red"></p>
                            <a href="/forget-password" class="forget-link" id="forgetpass"">
                                    <p>رمز عبور خود را فراموش کرده اید؟</p>
                                </a>
                                <a href="/login" class="signup-link">
                                <p>حساب کاربری دارید؟وارد شوید!</p>
                            </a>
                        </div>
                        <!-- end of second step -->
                        <!-- third step -->
                        <div class="signup" id="step3" style="display: none">
                            <div class="text-center"><img class="wogLogo" src="/images/wog-logo.png" alt=""></div>
                            <h1 class="tittle">مشخصات حساب</h1>
                            <input type="text" name="username" class="form-control login-input"
                                placeholder="نام کاربری">
                            <input type="email" name="email" class="form-control login-input" placeholder="ایمیل">
                            <input type="password" name="password" class="form-control login-input"
                                placeholder="رمز عبور">
                            <input type="password" name="confirmPassword" class="form-control login-input"
                                placeholder="رمز عبور مجدد">
                            <div>
                                <img src="/images/epic-games-icon.png" width="36px"/>
                                <input type="text" name="epicGamesID" class="form-control login-input login-input-with-icon" placeholder="آیدی EpicGames">
                            </div>
                            <div class="text-center" style="padding:10px 0">
                                <div class="btn btn-md btn-warning" id="accountDetails-submit-btn"
                                    onclick="accountDetailsSubmit()">بعدی</div>
                            </div>


                            <p id="error-accountDetails" style=" color:red"></p>
                        </div>
                        <!-- end of third step -->
                        <!-- fourth step -->
                        <div class=" signup" id="step4" style="display: none">
                            <div class="text-center"><img class="default-image" src="/images/mario-gamer.jpg"
                                    alt="default-picture"></div>
                            <h1 class="tittle">مشخصات شخصی</h1>
                            <input type="text" name="firstName" class="form-control login-input" placeholder="نام">
                            <input type="text" name="lastName" class="form-control login-input"
                                placeholder="نام خانوادگی">
                            <!-- <select name="gender" class="form-control login-input">
                                <option value="مرد">مرد</option>
                                <option value="زن">زن</option>
                            </select> -->
                            <!-- <div id="checkbox" style="float: right;">
                                <p style="color: orange;float: left;margin-top: 2px"> قوانین را خوانده و قبول دارم
                                    3بار !!! </p>
                                <input style="display:inline-block" type="checkbox" id="myCheck" onclick="myFunction()"
                                    name="terms">
                            </div> -->
                            <div style="padding:20px 0">
                                <input type="checkbox" style="width:16px;height:16px;position: relative;top:3px;">
                                <span style="color:orange">قوانین را خوانده و قبول دارم.</span>
                            </div>
                            <div class="text-center" style="padding:20px 0">
                                <input type="submit" class="btn btn-md btn-warning" value="ثبت نام" />
                            </div>
                            <p id="error-personalDetails" style=" color:red"></p>
                        </div>
                    </div>
                    <div class="col-md-4"></div>
                </div>
            </div>
        </form>

    </section>
    <script>
        $(() =>
        {
            // $("#step1").hide();
            // $("#step3").show();
            // $("#step3").hide();
            // $("#step4").show();
            $("form").submit(() =>
            {
                var firstName = $("#signupForm [name=firstName]").val();
                var lastName = $("#signupForm [name=lastName]").val();
                var age = $("#signupForm [name=size]").val();
                if (firstName == undefined || firstName.replace(' ', '') == '')
                {
                    $("#error-personalDetails").html("لطفا نام را وارد کنید.");
                    return false;
                }
                if (firstName.length < 3)
                {
                    $("#error-personalDetails").html("لطفا نام را درست وارد کنید.");
                    return false;
                }
                if (lastName == undefined || lastName.replace(' ', '') == '')
                {
                    $("#error-personalDetails").html("لطفا نام خانوادگی را وارد کنید.");
                    return false;
                }
                if (lastName.length < 3)
                {
                    $("#error-personalDetails").html("لطفا نام خانوادگی را درست وارد کنید.");
                    return false;
                }
                // if (age == undefined || age.replace(' ', '') == '')
                // {
                //     $("#error-personalDetails").html("لطفا سن را وارد کنید.");
                //     return false;
                // }
                if (!$("input[type=checkbox]").is(':checked'))
                {
                    $("#error-personalDetails").html('قوانین سایت را بخوانید .');
                    return false;
                }
                $("#error-personalDetails").html('');
                return true;
            });
        });
        // first part validation
        function phoneNumberSubmit()
        {
            var phoneNumber = $("#signupForm [name=phoneNumber]").val();
            if (phoneNumber == undefined || phoneNumber.replace(' ', '') == '')
            {
                $("#error-phoneNumber").html("لطفا شماره همراه خود را وارد کنید.");
                return false;
            }
            if (phoneNumber.length != 11)
            {
                $("#error-phoneNumber").html("شماره وارد شده اشتباه است.");
                return false;
            }
            if (phoneNumber.indexOf('09') == -1)
            {
                $("#error-phoneNumber").html("شماره وارد شده اشتباه است.");
                return;
            }
            $("#phoneNumber-submit-btn").css('opacity', 0);
            fetch('/signup-check-unique/?phoneNumber=' + phoneNumber, {
                method: 'GET',
            }).then(response => response.json()).then((result) =>
            {
                $("#phoneNumber-submit-btn").css('opacity', 1);
                if (result.available)
                {
                    $("#error-phoneNumber").html('در حال بارگذاری...');
                    //call webservice:
                    fetch('/otp/send-otp', {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ phoneNumber: phoneNumber, type: 'signup' }),

                    }).then((response => response.json())).then((result) =>
                    {
                        console.log(result);
                        if (result.error)
                        {
                            if (result.error == 'try again in a few seconds')
                                result.error = 'به تازگی یک کد فعال سازی برای شما ارسال شده، 60 ثانیه صبر کنید و مجدد تلاش کنید.';
                            $("#error-phoneNumber").html(result.error);
                        }
                        else
                        {
                            $("#error-phoneNumber").html('');
                            //hide this step and show next step:
                            $("#step1").hide(300);
                            $("#step2").show(300);
                        }
                    });
                    // $("#step3").show(300);
                    return true;
                }
                else
                {

                    $("#error-phoneNumber").html('کاربری قبلا با این شماره موبایل ثبت نام کرده است.');
                    return false;
                }
            }).catch((err) =>
            {
                $("#phoneNumber-submit-btn").css('opacity', 1);
                $("#error-phoneNumber").html(err.toString());
            });


        }
        // second step validation
        function confirmCodeSubmit()
        {
            var phoneNumber = $("#signupForm [name=phoneNumber]").val();
            var confirmCode = $("#signupForm [name=confirmCode]").val();
            if ((confirmCode == undefined || confirmCode.replace(' ', '') == '') || isEmptyString(confirmCode))
            {
                $("#error-confirmCode").html("لطفا کد تایید را وارد کنید.");
                return false;
            }
            $("#error-confirmCode").html('در حال بارگذاری...');
            //call webservice:
            fetch('/otp/check-otp', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ phoneNumber: phoneNumber, type: 'signup', code: confirmCode }),

            }).then((response => response.json())).then((result) =>
            {
                console.log(result);
                if (result.error || !result.ok)
                {
                    if (result.error == 'wrong code')
                        result.error = 'کد وارد شده اشتباه است';
                    $("#error-confirmCode").html(result.error);
                }
                else
                {
                    $("#error-confirmCode").html('');
                    //hide this step and show next step:
                    $("#step2").hide(300);
                    $("#step3").show(300);
                }
            });
        }
        // third step validation
        function accountDetailsSubmit()
        {
            var username = $("#signupForm [name=username]").val();
            var email = $("#signupForm [name=email]").val();
            var password = $("#signupForm [name=password]").val();
            var confirmPassword = $("#signupForm [name=confirmPassword]").val();
            if (username == undefined || username.replace(' ', '') == '')
            {
                $("#error-accountDetails").html("لطفا نام کاربری را وارد کنید.");
                return false;
            }
            if (username.length < 3)
            {
                $("#error-accountDetails").html("لطفا حداقل 3 کاراکتر برای نام کاربری خود وارد کنید.");
                return false;
            }
            if (password == undefined || password.replace(' ', '') == '')
            {
                $("#error-accountDetails").html("لطفا رمز عبور خود را وارد کنید.");
                return false;
            }
            if (password.length < 6)
            {
                $("#error-accountDetails").html("لطفا حداقل 6 کاراکتر برای رمز عبور خود وارد کنید.");
                return false;
            }
            if (confirmPassword == undefined || confirmPassword.replace(' ', '') == '')
            {
                $("#error-accountDetails").html("لطفا بخش تایید رمز عبور را پر کنید کنید.");
                return false;
            }
            if (confirmPassword != password)
            {
                $("#error-accountDetails").html("مقدار بخش رمز عبور و تایید رمز عبور یکسان نیست.");
                return false;
            }

            $("#accountDetails-submit-btn").css('opacity', 0);
            fetch(`/signup-check-unique/?username=${username}&email=${email}`, {
                method: 'GET',
            }).then(response => response.json()).then((result) =>
            {
                $("#accountDetails-submit-btn").css('opacity', 1);
                if (result.available)
                {
                    $("#error-accountDetails").html('');
                    //hide this step and show next step:
                    $("#step3").hide(300);
                    $("#step4").show(300);
                    return true;
                }
                else
                {

                    $("#error-accountDetails").html('کاربری قبلا با این نام کاربری یا ایمیل ثبت نام کرده است.');
                    return false;
                }
            }).catch((err) =>
            {
                $("#accountDetails-submit-btn").css('opacity', 1);
                $("#error-accountDetails").html(err.toString());
            });


        }
        function personalDetailsSubmit()
        {
            var firstName = $("#signupForm [name=firstName]").val();
            var lastName = $("#signupForm [name=lastName]").val();
            var age = $("#signupForm [name=size]").val();
            if (firstName == undefined || firstName.replace(' ', '') == '')
            {
                $("#error-personalDetails").html("لطفا نام را وارد کنید.");
                return false;
            }
            if (firstName.length < 3)
            {
                $("#error-personalDetails").html("لطفا نام را درست وارد کنید.");
                return false;
            }
            if (lastName == undefined || lastName.replace(' ', '') == '')
            {
                $("#error-personalDetails").html("لطفا نام خانوادگی را وارد کنید.");
                return false;
            }
            if (lastName.length < 3)
            {
                $("#error-personalDetails").html("لطفا نام خانوادگی را درست وارد کنید.");
                return false;
            }
            if (age == undefined || age.replace(' ', '') == '')
            {
                $("#error-personalDetails").html("لطفا سن را وارد کنید.");
                return false;
            }
            $("#error-personalDetails").html('');
        }
    </script>
    <script>
        document.getElementById("forgetpass").onclick = function () { forgetpass() };
        function forgetpass()
        {
            // window.alert("به جهنمم!!!");
        }
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</body>

</html>